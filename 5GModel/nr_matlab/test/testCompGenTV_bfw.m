% SPDX-FileCopyrightText: Copyright (c) 2025 NVIDIA CORPORATION & AFFILIATES. All rights reserved.
% SPDX-License-Identifier: Apache-2.0
%
% Licensed under the Apache License, Version 2.0 (the "License");
% you may not use this file except in compliance with the License.
% You may obtain a copy of the License at
%
% http://www.apache.org/licenses/LICENSE-2.0
%
% Unless required by applicable law or agreed to in writing, software
% distributed under the License is distributed on an "AS IS" BASIS,
% WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
% See the License for the specific language governing permissions and
% limitations under the License.

function [nCompChecks, nCompErrs, nTvGen, detErr] = testCompGenTV_bfw(caseSet, compTvMode, subSetMod, relNum)

tic;
if nargin == 0
    caseSet = 'full';
    compTvMode = 'both';
    subSetMod = [0, 1];
    relNum = 10000;
elseif nargin == 1
    compTvMode = 'both';
    subSetMod = [0, 1];
    relNum = 10000;
elseif nargin == 2
    subSetMod = [0, 1];
    relNum = 10000;
elseif nargin == 3
    relNum = 10000;
end

switch compTvMode
    case 'both'
        genTV = 1;
        testCompliance = 1;
    case 'genTV'
        genTV = 1;
        testCompliance = 0;
    case 'testCompliance'
        genTV = 0;
        testCompliance = 1;
    otherwise
        error('compTvMode is not supported...\n');
end

compact_TC  = [9000:9999];
full_TC     = [9000:9999];
selected_TC = [9000:9999];

if relNum == 2240 % disable all BFW TCs for Rel-22-4
    disabled_TC = [9000:9999]; 
else
    disabled_TC = [9224, 9038 : 9053, 9300:9305]; % 64T64R
end

% bypass_TC will be generated automatically from the lookup table below

if isnumeric(caseSet)
    TcToTest = caseSet;
else    
    switch caseSet
        case 'compact'
            TcToTest = compact_TC;
        case 'full'
            TcToTest = full_TC;
        case 'selected'
            TcToTest = selected_TC;
        otherwise
            error('caseSet is not supported...\n');
    end
end

% basic wideband SRS buffers
SRS_CHEST_BUFF_CFG0 = {...
%   UE#      startPrbGrp nPrbGrp nUeAnt nGnbAnt  Gain(dB)               
    0        0           137     4      32       0         % UE 0-9, SRS ChEst: 137 x 32 x 4
    1        0           137     4      32       0
    2        0           137     4      32       0
    3        0           137     4      32       0  
    4        0           137     4      32       0
    5        0           137     4      32       0
    6        0           137     4      32       0
    7        0           137     4      32       0
    8        0           137     4      32       0
    9        0           137     4      32       0
    10       0           64      4      32       0         % UEs 10-19: 64 x 32 x 4. Allocations contain prbGrps 16-64. But different start prbGrp. 
    11       1           64      4      32       0
    12       2           64      4      32       0
    13       3           64      4      32       0
    14       4           64      4      32       0
    15       5           64      4      32       0
    16       6           64      4      32       0
    17       7           64      4      32       0
    18       8           64      4      32       0
    19       9           64      4      32       0
};

% 30 MHz SRS buffers
SRS_CHEST_BUFF_CFG0_30MHZ = {...
%   UE#      startPrbGrp nPrbGrp nUeAnt nGnbAnt  Gain(dB)                
    0        0           39      4      32       0        % UE 0-19, SRS ChEst: 39 x 32 x 4
    1        0           39      4      32       0
    2        0           39      4      32       0
    3        0           39      4      32       0
    4        0           39      4      32       0
    5        0           39      4      32       0
    6        0           39      4      32       0
    7        0           39      4      32       0
    8        0           39      4      32       0
    9        0           39      4      32       0
    10       0           39      4      32       0
    11       1           39      4      32       0
    12       2           39      4      32       0
    13       3           39      4      32       0
    14       4           39      4      32       0
    15       5           39      4      32       0
    16       6           39      4      32       0
    17       7           39      4      32       0
    18       8           39      4      32       0
    19       9           39      4      32       0
};

% 50 MHz SRS buffers
SRS_CHEST_BUFF_CFG0_50MHZ = {...
%   UE#      startPrbGrp nPrbGrp nUeAnt nGnbAnt  Gain(dB)               
    0        0           67      4      32       0        % UE 0-19, SRS ChEst: 67 x 32 x 4
    1        0           67      4      32       0
    2        0           67      4      32       0
    3        0           67      4      32       0
    4        0           67      4      32       0
    5        0           67      4      32       0
    6        0           67      4      32       0
    7        0           67      4      32       0
    8        0           67      4      32       0
    9        0           67      4      32       0
    10       0           67      4      32       0
    11       1           67      4      32       0
    12       2           67      4      32       0
    13       3           67      4      32       0
    14       4           67      4      32       0
    15       5           67      4      32       0
    16       6           67      4      32       0
    17       7           67      4      32       0
    18       8           67      4      32       0
    19       9           67      4      32       0
};

%64 antenna SRS buffers
SRS_CHEST_BUFF_CFG20 = {...
%   UE#      startPrbGrp nPrbGrp nUeAnt nGnbAnt  Gain(dB)
    0        0           137     4      64       0         % UE 0-9, SRS ChEst: 137 x 64 x 4    
    1        0           137     4      64       0
    2        0           137     4      64       0
    3        0           137     4      64       0
    4        0           137     4      64       0
    5        0           137     4      64       0
    6        0           137     4      64       0
    7        0           137     4      64       0
    8        0           137     4      64       0
    9        0           137     4      64       0
    10       0           137     4      64       0
    11       0           137     4      64       0
    12       0           137     4      64       0
    13       0           137     4      64       0
    14       0           137     4      64       0
    15       0           137     4      64       0
    16       0           137     4      64       0
    17       0           137     4      64       0
    18       0           137     4      64       0
    19       0           137     4      64       0
    20       0           137     4      64       0
    21       0           137     4      64       0
    22       0           137     4      64       0 
};

%64 antenna SRS Partial PRB buffers
SRS_CHEST_BUF_CFG21 = {...
%   UE#      startPrbGrp nPrbGrp nUeAnt nGnbAnt  Gain(dB)
    0        50          30      4      64       0
    1        80          32      4      64       0
    2        80          16      4      64       0
    3        96          16      4      64       0
    4        30          2       4      64       0
};

%64 antenna SRS buffers PRG size 4
SRS_CHEST_BUFF_CFG22 = {...
%   UE#      startPrbGrp nPrbGrp nUeAnt nGnbAnt  Gain(dB)
    0            0         69      4      64     0        % UE 0-9, SRS ChEst: 69 x 64 x 4    
    1            0         69      4      64     0
    2            0         69      4      64     0
    3            0         69      4      64     0
    4            0         69      4      64     0
    5            0         69      4      64     0
    6            0         69      4      64     0
    7            0         69      4      64     0
    8            0         69      4      64     0
    9            0         69      4      64     0
    10           0         69      4      64     0
    11           0         69      4      64     0
    12           0         69      4      64     0
    13           0         69      4      64     0
    14           0         69      4      64     0
    15           0         69      4      64     0
};

SRS_CHEST_BUFF_CFG23 = {...
%   UE#      startPrbGrp nPrbGrp nUeAnt nGnbAnt  Gain(dB)
    0        0           137     2      64       0         % UE 0-9, SRS ChEst: 137 x 64 x 4    
    1        0           137     2      64       0
    2        0           137     2      64       0
    3        0           137     2      64       0
    4        0           137     2      64       0
    5        0           137     2      64       0
    6        0           137     2      64       0
    7        0           137     2      64       0
    8        0           137     2      64       0
    9        0           137     2      64       0
    10       0           137     2      64       0
    11       0           137     2      64       0
    12       0           137     2      64       0
    13       0           137     2      64       0
    14       0           137     2      64       0
    15       0           137     2      64       0
    16       0           137     2      64       0
    17       0           137     2      64       0
    18       0           137     2      64       0
    19       0           137     2      64       0
    20       0           137     2      64       0
    21       0           137     2      64       0
    22       0           137     2      64       0       
};

SRS_CHEST_BUFF_CFG24 = {...
%   UE#      startPrbGrp nPrbGrp nUeAnt nGnbAnt  Gain(dB)
    0        0           137     2      64       0         % UE 0-7. SRS ChEst: 137 x 64 x 2. Different channel gains.    
    1        0           137     2      64       5
    2        0           137     2      64       10
    3        0           137     2      64       15
    4        0           137     2      64       20
    5        0           137     2      64       -20
    6        0           137     2      64       -15
    7        0           137     2      64       -10
    8        0           137     2      64       -5
};


SRS_CHEST_BUFF_CFG25 = {...
%   UE#      startPrbGrp nPrbGrp nUeAnt nGnbAnt  Gain(dB)
    0        0            52     2      64       0         % UE 0-21. SRS ChEst: 53 x 64 x 2
    1        0            52     2      64       0
    2        0            52     2      64       0
    3        0            52     2      64       0
    4        0            52     2      64       0
    5        0            52     2      64       0
    6        0            52     2      64       0
    7        0            52     2      64       0
    8        0            52     2      64       0
    9        0            52     2      64       0
    10       0            52     2      64       0
    11       0            52     2      64       0
    12       0            52     2      64       0
    13       0            52     2      64       0
    14       0            52     2      64       0
    15       0            52     2      64       0
    16       0            52     2      64       0
    17       0            52     2      64       0
    18       0            52     2      64       0
    19       0            52     2      64       0
    20       0            52     2      64       0
    21       0            52     2      64       0
    22       0            52     2      64       0
};

% build SRS_CHEST_BUFF_CFG26
ueNumbers = (0:71).';
commonValues = repmat([0, 137, 2, 64, 0], 72, 1);  % startPrbGrp, nPrbGrp, nUeAnt, nGnbAnt, gainDB
SRS_CHEST_BUFF_CFG26 = [num2cell(ueNumbers), num2cell(commonValues)];

% build SRS_CHEST_BUFF_CFG27
ueNumbers = (0:47).';
commonValues = repmat([0, 137, 2, 64, 0], 48, 1);  % startPrbGrp, nPrbGrp, nUeAnt, nGnbAnt, gainDB
SRS_CHEST_BUFF_CFG27 = [num2cell(ueNumbers), num2cell(commonValues)];

% build SRS_CHEST_BUFF_CFG28
ueNumbers = (0:23).';
commonValues = repmat([0,  69, 2, 64, 0], 24, 1);  % startPrbGrp, nPrbGrp, nUeAnt, nGnbAnt, gainDB
SRS_CHEST_BUFF_CFG28 = [num2cell(ueNumbers), num2cell(commonValues)];

% build SRS_CHEST_BUFF_CFG29
ueNumbers = (0:47).';
commonValues = repmat([0, 137, 2, 64, 0], 48, 1);  % startPrbGrp, nPrbGrp, nUeAnt, nGnbAnt, gainDB
SRS_CHEST_BUFF_CFG29 = [num2cell(ueNumbers), num2cell(commonValues)];

% Note: Even test cases are used for DLBFW and odd cases are ULBFW
UE_GRPS_CFG = {...
% SRS bank configuration
%   UEGRP#      startPrb    nPrb      nRxAnt nBfLayers     ueIdxs             ueLayersIdxs                
    0           0           273        32     8       [0 3 5 6 7 8 9 2]  [0 1 3 2 1 2 2 3]    % UEGRPS 0-4: 137 x 32 x 8. Vary how layers divided amonng the UEs.
    1           0           273        32     4       [0 3 5 9]          [0 3 0 1]
    2           0           273        32     8       [1 1 1 1 3 3 3 3]  [0 1 2 3 3 2 1 0]
    3           0           273        32     4       [2 3 4 7]          [0 1 2 3]
    4           0           273        32     8       [2 2 5 5 3 4 7 9]  [0 3 1 2 0 3 2 1]
    5           0           2          32     4       [0 3 5 6]          [0 1 3 2]            % UEGRPS 5-9. v x 32 x 8. Vary number of PrbGrps
    6           0           22         32     8       [0 3 5 6 7 8 9 2]  [0 1 3 2 1 2 2 3]
    7           0           62         32     4       [0 3 5 6]          [0 1 3 2]
    8           0           158        32     8       [0 3 5 6 7 8 9 2]  [0 1 3 2 1 2 2 3]
    9           0           222        32     4       [0 3 5 6]          [0 1 3 2]
    10          0           32         32     8       [0 0 3 3 5 5 9 9]  [0 3 0 1 3 1 2 0]    % UEGRPS 10-14. 16 x 32 x 8. Vary start PrbGrp.
    11          32          32         32     4       [0 3 5 9]          [0 3 0 1]
    12          64          32         32     8       [0 0 3 3 5 5 9 9]  [0 3 0 1 3 1 2 0]    
    13          128         32         32     4       [0 3 5 9]          [0 3 0 1]
    14          144         32         32     8       [0 0 3 3 5 5 9 9]  [0 3 0 1 3 1 2 0]    % UEGRPS 15-19. 16 x 32 x v. Vary number of layers (8,4,2,1).
    15          0           32         32     4       [3 5 7 9]          [2 2 2 2]                                                                                             
    16          0           32         32     4       [8 8 3 3]          [1 2 0 3]
    17          0           32         32     2       [0 7]              [0 0]
    18          0           32         32     2       [3 3]              [0 3]
    19          0           32         32     1       [7]                [2]                       
    20          32          64         32     4       [10 11 12 13]      [3 1 2 3]            % UEGRPS 20-24. 32 x 32 x 4. Test prbGrp indexing
    21          34          64         32     4       [14 15 16 17]      [0 1 2 3]
    22          36          64         32     4       [12 13 14 17]      [1 1 1 1]
    23          40          64         32     4       [17 14 13 12]      [0 1 2 3]
    24          44          64         32     4       [10 11 12 13]      [2 1 2 3]    
    25          0           273        32     1       [0]                [1]                   % UEGRPS 25-34. wideband.
    26          0           273        32     2       [0 3]              [1 2]
    27          0           273        32     2       [1 1]              [1 3]
    28          0           273        32     4       [3 3 3 3]          [0 1 2 3]
    29          0           273        32     4       [4 4 5 6]          [0 1 2 2]
    30          0           273        32     8       [1 2 3 4 5 6 7 8]  [0 0 1 1 2 2 0 0]
    31          0           273        32     8       [1 1 2 2 3 4 5 6]  [0 1 0 1 0 0 0 0]
    32          0           273        32     8       [1 1 1 1 2 2 2 2]  [0 1 2 3 0 1 2 3]
    33          0           273        32     8       [1 1 1 1 2 2 3 3]  [0 1 2 3 0 1 0 1]
    34          0           273        32     8       [1 1 1 1 2 2 4 5]  [0 1 2 3 0 1 0 0]
    35          0           108         32     1      [0]                [0]                  % UEGRPS 35-39. SIB1 SLOT PDSH LOWER.
    36          0           108         32     2      [1 1]              [0 1]
    37          0           108         32     4      [2 2 2 2]          [0 1 2 3]
    38          0           108         32     8      [0 0 1 1 2 2 3 3]  [2 3 2 3 2 3 2 3]
    39          0           108         32     8      [0 0 0 0 2 2 2 2]  [0 1 2 3 0 1 2 3]
    40          0           118         32     1      [5]                [0]                 % UEGRPS 40-44. SIB1 SLOT PDSH UPPER.
    41          0           118         32     2      [5 5]              [0 1]                                                                                           
    42          0           118         32     4      [6 6 6 6]          [0 1 2 3]
    43          0           118         32     8      [5 5 6 6 7 7 8 8]  [0 1 0 1 0 1 0 1]
    44          0           118         32     8      [5 5 5 5 7 7 7 7]  [0 1 2 3 0 1 2 3]
    45          0           32         32     7       [0 0 0 2 2 5 5]    [0 1 2 0 3 1 2 3]    % UEGRPS 45-48. Vary number of layer (7,6,5,3)                                                                                   
    46          0           32         32     6       [3 3 0 0 1 5]      [1 3 2 0 3 1]
    47          64          32         32     5       [2 2 1 1 8]        [1 3 3 1 0]
    48          64          32         32     3       [8 2 4]            [3 2 1]
    49          0           273        64     8       [0 3 5 6 7 8 9 2]  [0 1 3 2 1 2 2 3] % UEGRPS 49-56: 64 antennas, vary number layers 1-8
    50          0           273        64     7       [0 3 5 6 7 8 9]     [0 1 3 2 1 2 2]     
    51          0           273        64     6       [0 3 5 6 7 8]        [0 1 3 2 1 2]
    52          0           273        64     5       [0 3 5 6 7]           [0 1 3 2 1]
    53          0           273        64     4       [0 3 5 6]              [0 1 3 2]
    54          0           273        64     3       [0 3 5]                 [0 1 3]
    55          0           273        64     2       [0 3]                    [0 1]
    56          0           273        64     1       [0]                       [0]
    57          0           273        64     9       [1 1 1 1 7 7 7 7 4]                      [0 1 2 3 0 1 2 3 0]  % UEGRPS 57-64: 64 antennas, vary number layers 9-16
    58          0           273        64     10      [1 1 1 1 7 7 7 7 4 4]                   [0 1 2 3 0 1 2 3 0 1]
    59          0           273        64     11      [1 1 1 1 7 7 7 7 4 4 4]                [0 1 2 3 0 1 2 3 0 1 2]
    60          0           273        64     12      [1 1 1 1 7 7 7 7 4 4 4 4]             [0 1 2 3 0 1 2 3 0 1 2 3]
    61          0           273        64     13      [1 1 1 1 7 7 7 7 4 4 4 4 2]          [0 1 2 3 0 1 2 3 0 1 2 3 0]
    62          0           273        64     14      [1 1 1 1 7 7 7 7 4 4 4 4 2 2]       [0 1 2 3 0 1 2 3 0 1 2 3 0 1]
    63          0           273        64     15      [1 1 1 1 7 7 7 7 4 4 4 4 2 2 2]    [0 1 2 3 0 1 2 3 0 1 2 3 0 1 2]
    64          0           273        64     16      [1 1 1 1 7 7 7 7 4 4 4 4 2 2 2 2] [0 1 2 3 0 1 2 3 0 1 2 3 0 1 2 3]
    65          0           78         32     8       [0 3 5 6 7 8 9 2]  [0 1 3 2 1 2 2 3]                  % 30 MHz 8 layers
    66          0           78         32     4       [0 3 5 9]          [0 3 0 1]                          % 30 MHz 4 layers
    67          0           134        32     8       [0 3 5 6 7 8 9 2]  [0 1 3 2 1 2 2 3]                  % 50 MHz 8 layers
    68          0           134        32     4       [0 3 5 9]          [0 3 0 1]                          % 50 MHz 4 layers
    69          10          60         32     8       [0 3 5 6 7 8 9 2]  [0 1 3 2 1 2 2 3]                  % partial allocation 8 layers
    70          10          60         32     4       [0 3 5 9]          [0 3 0 1]  
    71          0           273        64     16      [3 12 5 10 7 2 15 13 4 14 8 6 9 1 11 0] [0 1 2 3 0 1 2 3 0 1 2 3 0 1 2 3]% partial allocation 4 layers
    72          0           273        64     2       [0 0]                    [0 1]
    73          0           273        64     2       [0 3]                    [0 1]
    74          0           273        64     4       [0 3 5 6]                [0 0 0 0]
    75          0           273        64     4       [0 0 3 3]                [0 1 0 1]
    76          0           273        64     8       [0 0 3 3 5 5 6 6]        [0 1 0 1 0 1 0 1]
    77        100            60        64     1       [0]                      [0]
    78        160            64        64     1       [1]                      [0]
    79         60             4        64     1       [4]                      [0]
    80        160            64        64     1       [1]                      [0]
    81          0           273        64    16       [0 0 3 3 5 5 6 6 8 8 2 2 9 9 7 7]  [0 1 0 1 0 1 0 1 1 0 1 0 1 0 1 0]
    82          0           273        64    16       [0 0 3 3 6 3 6 3 0 0 5 5 5 5 6 6]  [1 0 3 2 2 1 3 0 3 2 0 1 2 3 0 1]
    83        160            64        64     4       [0 5 3 6]                [0 1 0 1]
    84        160            64        64     8       [0 5 3 7 9 2 8 6]        [0 1 0 1 1 1 1 1]
    85          0           100        64     8       [0 0 5 5 7 7 9 9]        [0 1 0 1 0 1 0 1]
    86        100           100        64     8       [3 3 6 6 8 8 2 2]        [0 1 0 1 0 1 0 1]
    87        100            50        64     8       [3 3 6 6 8 8 2 2]        [0 1 0 1 0 1 0 1]
    88        110            80        64     8       [3 3 6 6 8 8 2 2]        [0 1 0 1 0 1 0 1]
    89          0           100        64     9       [0 5 5 5 5 7 7 9 9]      [0 0 1 2 3 0 1 0 1]
    90        100           100        64     7       [3 3 6 8 8 2 2]          [0 1 0 0 1 0 1]
    91        120            80        64     7       [3 3 6 8 8 2 2]          [0 1 0 0 1 0 1]
    92          0            10        64     5       [0 7 7 7 7]              [0 0 1 2 3]
    93         10            60        64     3       [3 3 8]                  [0 1 0]
    94        100            50        64     6       [5 5 5 5 9 9]            [0 1 2 3 0 1]
    95        150            50        64     2       [6 2]                    [0 0]
    96         30            20        64     2       [3 3]                    [0 1]
    97         50            20        64     4       [5 5 5 5]                [0 1 3 2]
    98          0            20        64     1       [6]                      [0]
    99         90            20        64     4       [7 7 7 7]                [0 3 1 2]
   100        110            20        64     1       [8]                      [0]
   101        150            20        64     1       [9]                      [0]
   102        200            40        64     2       [2 2]                    [0 1]
   103         80            60        64     3       [5 6 6]                  [0 0 1]
   104          0            60        64     3       [0 3 3]                  [0 0 1]
   105         80           120        64     4       [5 5 5 6]                [0 1 2 1]
   106         90            60        64     3       [8 9 2]                  [0 1 0]
   107         90            60        64     4       [9 9 2 2]                [0 1 0 1]
   108         90           100        64     8       [9 9 9 9 2 2 2 2]        [0 1 3 2 3 2 0 1]
   109         30            20        64     3       [5 5 5]                  [0 2 1]
   110         80             6        64     5       [3 3 4 4 4]              [0 1 2 1 0]
   111        100            16        64     6       [1 1 8 8 8 8]            [0 1 2 1 0 3]
   112        120            10        64     7       [11 11 11 10 10 10 10]   [0 1 2 1 0 3 2]
   113          0            60        64     1       [0]                      [0]
   114         10            60        64     3       [0 3 5]                  [0 1 3]
   115         60            20        64     2       [0 0]                    [0 1]
   116         20            16        64     2       [0 0]                    [0 1]
   117         60            16        64     4       [7 7 7 7]                [0 2 1 3]
   118         40            10        64     3       [5 5 5]                  [0 2 1]
   119        140           100        64     8       [9 9 9 9 2 2 2 2]        [0 1 3 2 3 2 0 1]
   120         20            10        64     1       [0]                      [0]
   121         20            80        64    16       [0 0 0 0 1 1 1 1 2 2 2 2 3 3 3 3] [0 1 2 3 0 1 2 3 0 1 2 3 0 1 2 3] % DLMIX PDSCH 408-411
   122        100           100        64     4       [4 4 5 5]                [0 1 0 1] % DLMIX PDSCH 412 & 413
   123        200            72        64     1       [6]                      [0] % DLMIX PDSCH 414
   124         20            80        64     4       [0 0 0 0]                [0 1 2 3] % DLMIX PDSCH 408
   125        100           100        64     2       [4 4]                    [0 1] % DLMIX PDSCH 412
   126        100            40        64     8       [0 0 1 1 2 2 3 3]        [0 1 0 1 0 1 0 1] % ULMIX PUSCH 610-613
   127        150            40        64     1       [4]                      [0] % ULMIX PUSCH 614
   128        200            40        64     1       [6]                      [0] % ULMIX PUSCH 615
   129        100            40        64     2       [0 0]                    [0 1] % ULMIX PUSCH 610
   130          0            32        32     1       [0]                      [0]
   131         20            80        64     8       [0 0 0 0 1 1 1 1]        [0 1 2 3 0 1 2 3] % DLMIX PDSCH 408-409
   132        100            40        64     4       [0 0 1 1]                [0 1 0 1] % ULMIX PUSCH 610-611
   133        160            64        64     2       [1 1]                    [0 1]
%  UEGRP#      startPrb    nPrb      nRxAnt nBfLayers     ueIdxs             ueLayersIdxs  
 % perf pattern 64, 7 UEGs, 16 UEs (with ssb) 
   134         20            22         64    16      [0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3]     [0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3];
   135         40            20         64    8      [0, 0, 0, 0, 1, 1, 1, 1]     [0, 1, 2, 3, 0, 1, 2, 3];
   136         60            20         64    8      [0, 0, 0, 0, 1, 1, 1, 1]     [0, 1, 2, 3, 0, 1, 2, 3];
   137         78            20         64    8      [0, 0, 0, 0, 1, 1, 1, 1]     [0, 1, 2, 3, 0, 1, 2, 3];
   138         98            20         64    8      [0, 0, 0, 0, 1, 1, 1, 1]     [0, 1, 2, 3, 0, 1, 2, 3];
   139        116            10         64    4      [0, 0, 1, 1]            [0, 1, 0, 1];
   140        126            10         64    4      [0, 0, 1, 1]            [0, 1, 0, 1];
   % perf pattern 64, 7 UEGs, 16 UEs (no ssb) 
   141          0            24         64    16     [0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3]     [0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3];
   142         24            22         64    8      [0, 0, 0, 0, 1, 1, 1, 1]     [0, 1, 2, 3, 0, 1, 2, 3];
   143         46            22         64    8      [0, 0, 0, 0, 1, 1, 1, 1]     [0, 1, 2, 3, 0, 1, 2, 3];
   144         68            22         64    8      [0, 0, 0, 0, 1, 1, 1, 1]     [0, 1, 2, 3, 0, 1, 2, 3];
   145         90            22         64    8      [0, 0, 0, 0, 1, 1, 1, 1]     [0, 1, 2, 3, 0, 1, 2, 3];
   146        112            12         64    4      [0, 0, 1, 1]            [0, 1, 0, 1];
   147        124            12         64    4      [0, 0, 1, 1]            [0, 1, 0, 1];
    % perf pattern 64, 7 UEGs, 16 UEs (no prach) 
   148          4            24         64    8      [0, 0, 1, 1, 2, 2, 3, 3]     [0, 1, 0, 1, 0, 1, 0, 1];
   149         26            22         64    4      [0, 0, 1, 1]            [0, 1, 0, 1];
   150         48            22         64    4      [0, 0, 1, 1]            [0, 1, 0, 1];
   151         68            22         64    4      [0, 0, 1, 1]            [0, 1, 0, 1];
   152         90            22         64    4      [0, 0, 1, 1]            [0, 1, 0, 1];
   153        110            12         64    2      [0, 1]                  [0, 0];
   154        122            12         64    2      [0, 1]                  [0, 0];
    % perf pattern 64, 7 UEGs, 16 UEs (with 4 prach) 
   155         4             16         64    8      [0, 0, 1, 1, 2, 2, 3, 3]     [0, 1, 0, 1, 0, 1, 0, 1];
   156         20            14         64    4      [0, 0, 1, 1]            [0, 1, 0, 1];
   157         34            14         64    4      [0, 0, 1, 1]            [0, 1, 0, 1];
   158         48            14         64    4      [0, 0, 1, 1]            [0, 1, 0, 1];
   159         62            14         64    4      [0, 0, 1, 1]            [0, 1, 0, 1];
   160         76             6         64    2      [0, 1]                  [0, 0];
   161         82             6         64    2      [0, 1]                  [0, 0];
    % perf pattern 64, 7 UEGs, 16 UEs (with 3 prach) 
   162          4            18         64    8      [0, 0, 1, 1, 2, 2, 3, 3]     [0, 1, 0, 1, 0, 1, 0, 1];
   163         22            16         64    4      [0, 0, 1, 1]            [0, 1, 0, 1];
   164         38            16         64    4      [0, 0, 1, 1]            [0, 1, 0, 1];
   165         54            16         64    4      [0, 0, 1, 1]            [0, 1, 0, 1];
   166         70            16         64    4      [0, 0, 1, 1]            [0, 1, 0, 1];
   167         86             6         64    2      [0, 1]                  [0, 0];
   168         92             6         64    2      [0, 1]                  [0, 0];
%  UEGRP#      startPrb    nPrb      nRxAnt nBfLayers     ueIdxs             ueLayersIdxs  
   169         20            80         64    8      [0 1 2 3 4 5 6 7]       [0 0 0 0 0 0 0 0] % DLMIX PDSCH 456-463
   170        120            40         64    8      [6 7 8 9 10 11 12 13]   [0 0 0 0 0 0 0 0] % DLMIX PDSCH 470-477
   171        120           152         64    2      [6 7]                   [0 0]             % DLMIX PDSCH 484,485
   172         20            20         64    7      [0 0 0 3 3 3 3]         [0 1 2 0 1 2 3]
   173         40            20         64    9      [5 5 5 5 6 7 8 8 9 ]    [0 1 2 3 0 0 0 1 0]
   % perf pattern 65, 1 UEGs, 4 UEs (with ssb) 
   174         20           252         64    16      [0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3]     [0, 1, 2,3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3];
   % perf pattern 65, 1 UEGs, 4 UEs (no ssb) 
   175         0            272         64    16      [0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3]     [0, 1, 2,3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3];
   % perf pattern 65, 1 UEGs, 4 UEs (no prach) 
   176         4            268         64    8      [0, 0, 1, 1, 2, 2, 3, 3]     [0, 1, 0, 1, 0, 1, 0, 1];
   % perf pattern 65, 1 UEGs, 4 UEs (with 4 prach) 
   177         4            220         64    8      [0, 0, 1, 1, 2, 2, 3, 3]     [0, 1, 0, 1, 0, 1, 0, 1];
   % perf pattern 65, 1 UEGs, 4 UEs (with 3 prach) 
   178         4            232         64    8      [0, 0, 1, 1, 2, 2, 3, 3]     [0, 1, 0, 1, 0, 1, 0, 1];
   % 64TR 3 peak cells, 1 UEGs, 8 UEs, one layer per UE (ULMIX, no prach)
   179         0            273         64    8      [0, 1, 2, 3, 4, 5, 6, 7]     [0, 0, 0, 0, 0, 0, 0, 0];
   % 64TR 3 peak cells, 1 UEGs, 16 UEs, one layer per UE (DLMIX, no ssb)
   180         0            273         64    16     [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15]     [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
   % 64TR 3 peak cells, 1 UEGs, 8 UEs, one layer per UE (ULMIX, no prach)
   181         0            273         64    8      [0, 1, 2, 3, 4, 5, 6, 7]     [0, 0, 0, 0, 0, 0, 0, 0];
   % 64TR 3 peak cells, 1 UEGs, 8 UEs, two layers per UE (DLMIX, no ssb)
   182         0            273         64    16     [0, 0, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7]   [0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1];
   183         0            273         64     4     [0, 0, 1, 1]    [0, 1, 0, 1];
   184         0            273         64     5     [0, 1, 2, 3, 4] [0, 0, 0, 0, 0];
   185         0            273         64     4     [5, 5, 6, 6] [0, 1, 0, 1];
   186         0            273         64     4     [5, 6, 7, 8] [0, 0, 0, 0];
   187         0            273         64     4     [2, 2, 7, 7] [0, 1, 0, 1];
   188         0            273         64     9     [0, 1, 2, 3, 4, 5, 6, 7, 8] [0, 0, 0, 0, 0, 0, 0, 0, 0];
%  UEGRP#      startPrb    nPrb      nRxAnt nBfLayers     ueIdxs             ueLayersIdxs  
   % 64TR peak perf pattern 67/69
   189         0            273         64    8      [6 7 8 9 10 11 12 13]        [0 0 0 0 0 0 0 0] % DLMIX PDSCH 570-577, 591:598, 641:648, 662:669
   190         0            273         64    8      [6 7 8 9 6 7 8 9]            [0 0 0 0 1 1 1 1] % DLMIX PDSCH 578-581, 649:652
   191        20            253         64    8      [6 7 8 9 10 11 12 13]        [0 0 0 0 0 0 0 0] % DLMIX PDSCH 583:590, 654:661
   % 64TR column G
   192         0            273         64    16     [6:21]                       [zeros(1,16)];
   193         6            219         64    8      [14:21]                      [zeros(1,8)];
   194        22            251         64    8      [6:13]                       [zeros(1,8)];
   % 64TR ave perf pattern 66
   195         0            136         64    8      [6 7 8 9 10 11 12 13]        [0 0 0 0 0 0 0 0] % DLMIX PDSCH 688-695, 709:716
   196         0            136         64    8      [6 7 8 9 6 7 8 9]            [0 0 0 0 1 1 1 1] % DLMIX PDSCH 696:699
   197        20            116         64    8      [6 7 8 9 10 11 12 13]        [0 0 0 0 0 0 0 0] % DLMIX PDSCH 701:708
   % 64TR column G
   198        20            253         64    16     [6:21]                       [zeros(1,16)];
   % 64TR column H
   199        26            247         64    8      [6:13]                       [zeros(1,8)];
   200        10            215         64    8      [14:21]                       [zeros(1,8)];
   % 64TR column G 40 MHz
   201        22             84         64    8      [6:13]                       [zeros(1,8)];
   202        20             86         64    16     [6:21]                       [zeros(1,16)];
   203         6             52         64    8      [14:21]                       [zeros(1,8)];
   204         0            106         64    16     [6:21]                       [zeros(1,16)];   
   % Adaptation of 193 & 194 but 2 layers
   205        22            62          64    2      [6:7]                        [zeros(1,2)];
   206        84            62          64    2      [8:9]                        [zeros(1,2)];
   207       146            62          64    2      [10:11]                      [zeros(1,2)];
   208       208            65          64    2      [12:13]                      [zeros(1,2)];
   209         6            54          64    2      [14:15]                      [zeros(1,2)];
   210        60            54          64    2      [16:17]                      [zeros(1,2)];
   211       114            54          64    2      [18:19]                      [zeros(1,2)];
   212       168            57          64    2      [20:21]                      [zeros(1,2)];
   % Adaptation of 193 & 194 but 4 layers
   213        22            126         64    4      [6:9]                        [zeros(1,4)];
   214       148            125         64    4      [10:13]                      [zeros(1,4)];
   215         6            110         64    4      [14:17]                      [zeros(1,4)];
   216       116            109         64    4      [18:21]                      [zeros(1,4)];
   % 64TR column G 100 MHz, 64 UEs per TTI
%   UEGRP#      startPrb    nPrb      nRxAnt nBfLayers         ueIdxs               ueLayersIdxs
   217         22          8         64     8         [ 6  6  7  7  8  8  9  9]  [0 1 0 1 0 1 0 1]                   
   218         30          12        64     8         [10 10 11 11 12 12 13 13]  [0 1 0 1 0 1 0 1]                   
   219         42          16        64     8         [14 14 15 15 16 16 17 17]  [0 1 0 1 0 1 0 1]                   
   220         58          18        64     8         [18 18 19 19 20 20 21 21]  [0 1 0 1 0 1 0 1]                   
   221         76          20        64     8         [22 22 23 23 24 24 25 25]  [0 1 0 1 0 1 0 1]                   
   222         96          22        64     8         [26 26 27 27 28 28 29 29]  [0 1 0 1 0 1 0 1]                   
   223         118         24        64     8         [30 30 31 31 32 32 33 33]  [0 1 0 1 0 1 0 1]                   
   224         142         22        64     8         [34 34 35 35 36 36 37 37]  [0 1 0 1 0 1 0 1]                   
   225         164         20        64     8         [38 38 39 39 40 40 41 41]  [0 1 0 1 0 1 0 1]                   
   226         184         18        64     8         [42 42 43 43 44 44 45 45]  [0 1 0 1 0 1 0 1]                   
   227         202         16        64     8         [46 46 47 47 48 48 49 49]  [0 1 0 1 0 1 0 1]                   
   228         218         14        64     8         [50 50 51 51 52 52 53 53]  [0 1 0 1 0 1 0 1]                   
   229         232         12        64     8         [54 54 55 55 56 56 57 57]  [0 1 0 1 0 1 0 1]                   
   230         244         10        64     8         [58 58 59 59 60 60 61 61]  [0 1 0 1 0 1 0 1]                   
   231         254         8         64     8         [62 62 63 63 64 64 65 65]  [0 1 0 1 0 1 0 1]                   
   232         262         11        64     8         [66 66 67 67 68 68 69 69]  [0 1 0 1 0 1 0 1]                   
   233         20          30        64     16        [ 6  6  7  7  8  8  9  9 10 10 11 11 12 12 13 13]  [0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1]                   
   234         50          30        64     16        [14 14 15 15 16 16 17 17 18 18 19 19 20 20 21 21]  [0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1]                   
   235         80          32        64     16        [22 22 23 23 24 24 25 25 26 26 27 27 28 28 29 29]  [0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1]                   
   236         112         32        64     16        [30 30 31 31 32 32 33 33 34 34 35 35 36 36 37 37]  [0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1]                   
   237         144         32        64     16        [38 38 39 39 40 40 41 41 42 42 43 43 44 44 45 45]  [0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1]                   
   238         176         32        64     16        [46 46 47 47 48 48 49 49 50 50 51 51 52 52 53 53]  [0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1]                   
   239         208         32        64     16        [54 54 55 55 56 56 57 57 58 58 59 59 60 60 61 61]  [0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1]                   
   240         240         33        64     16        [62 62 63 63 64 64 65 65 66 66 67 67 68 68 69 69]  [0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1]                   
   241         6           6         64     8         [ 6  6  7  7  8  8  9  9]  [0 1 0 1 0 1 0 1]                   
   242         12          10        64     8         [10 10 11 11 12 12 13 13]  [0 1 0 1 0 1 0 1]                   
   243         22          14        64     8         [14 14 15 15 16 16 17 17]  [0 1 0 1 0 1 0 1]                   
   244         36          16        64     8         [18 18 19 19 20 20 21 21]  [0 1 0 1 0 1 0 1]                   
   245         52          18        64     8         [22 22 23 23 24 24 25 25]  [0 1 0 1 0 1 0 1]                   
   246         70          20        64     8         [26 26 27 27 28 28 29 29]  [0 1 0 1 0 1 0 1]                   
   247         90          22        64     8         [30 30 31 31 32 32 33 33]  [0 1 0 1 0 1 0 1]                   
   248         112         20        64     8         [34 34 35 35 36 36 37 37]  [0 1 0 1 0 1 0 1]                   
   249         132         18        64     8         [38 38 39 39 40 40 41 41]  [0 1 0 1 0 1 0 1]                   
   250         150         16        64     8         [42 42 43 43 44 44 45 45]  [0 1 0 1 0 1 0 1]                   
   251         166         14        64     8         [46 46 47 47 48 48 49 49]  [0 1 0 1 0 1 0 1]                   
   252         180         12        64     8         [50 50 51 51 52 52 53 53]  [0 1 0 1 0 1 0 1]                   
   253         192         10        64     8         [54 54 55 55 56 56 57 57]  [0 1 0 1 0 1 0 1]                   
   254         202         8         64     8         [58 58 59 59 60 60 61 61]  [0 1 0 1 0 1 0 1]                   
   255         210         6         64     8         [62 62 63 63 64 64 65 65]  [0 1 0 1 0 1 0 1]                   
   256         216         9         64     8         [66 66 67 67 68 68 69 69]  [0 1 0 1 0 1 0 1]                   
   257         0           34        64     16        [ 6  6  7  7  8  8  9  9 10 10 11 11 12 12 13 13]  [0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1]                   
   258         34          34        64     16        [14 14 15 15 16 16 17 17 18 18 19 19 20 20 21 21]  [0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1]                   
   259         68          34        64     16        [22 22 23 23 24 24 25 25 26 26 27 27 28 28 29 29]  [0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1]                   
   260         102         34        64     16        [30 30 31 31 32 32 33 33 34 34 35 35 36 36 37 37]  [0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1]                   
   261         136         34        64     16        [38 38 39 39 40 40 41 41 42 42 43 43 44 44 45 45]  [0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1]                   
   262         170         34        64     16        [46 46 47 47 48 48 49 49 50 50 51 51 52 52 53 53]  [0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1]                   
   263         204         34        64     16        [54 54 55 55 56 56 57 57 58 58 59 59 60 60 61 61]  [0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1]                   
   264         238         35        64     16        [62 62 63 63 64 64 65 65 66 66 67 67 68 68 69 69]  [0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1]    
%   UEGRP#      startPrb    nPrb      nRxAnt nBfLayers         ueIdxs               ueLayersIdxs
   265         26          122       64     4         [ 6  7  8  9         ]  [0 0 0 0]
   266         148         125       64     4         [10 11 12 13         ]  [0 0 0 0]
   267         20          253       64     16        [ 6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21]  [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   268         10          124       64     4         [14 15 16 17         ]  [0 0 0 0]
   269         134         127       64     4         [18 19 20 21         ]  [0 0 0 0]
   270         0           273       64     16        [ 6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21]  [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   271         0           265       64     16        [ 6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21]  [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   272         26          247       64     8         [ 6  7  8  9 10 11 12 13]  [0 0 0 0 0 0 0 0]
   273         20          253       64     16        [ 6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21]  [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   274         10          251       64     8         [14 15 16 17 18 19 20 21]  [0 0 0 0 0 0 0 0]
   275         0           273       64     16        [ 6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21]  [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   276         0           265       64     16        [ 6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21]  [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   277         0           273       64     8         [ 7 7 9 9 8 8 6 6]                 [0 1 0 1 0 1 0 1];
   278         0           273       64     16        [ 6 6 9 9 10 10 11 11 12 12 13 13 7 8 14 15]               [0 1 0 1 0 1 0 1 0 1 0 1 0 0 0 0];
   279         0           273       64     6         [ 6 6 9 9 7 8]                     [0 1 0 1 0 0];
   280         10          263       64     8         [14 15 16 17 18 19 20 21]          [0 0 0 0 0 0 0 0];
   281         20          80        64     16        [ 6 6 6 6 7 7 7 7 8 8 8 8 9 9 9 9]  [0 1 2 3 0 1 2 3 0 1 2 3 0 1 2 3];
   282         100         50        64     6         [10 10 11 11 12 12]                 [0 1 0 1 0 1];
   283         150         50        64     2         [13 14]                             [0 0];
   284         200         73        64     1         [15]                                [0];
   285         20          80        64     4         [ 6 6 6 6]                          [0 1 2 3];
   286         100         50        64     4         [ 10 10 10 10]                      [0 1 2 3];
   287         150         50        64     4         [ 11 11 11 11]                      [0 1 2 3];
   288         200         73        64     4         [ 12 12 12 12]                      [0 1 2 3];
   289         20          252       64     24        [ 6 6 7 7 8 8 9 9 10 10 11 11 12 12 13 13 14 14 15 15 16 16 17 17]  [0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1];
   290         0           273       64     32        [ 6 6 7 7 8 8 9 9 10 10 11 11 12 12 13 13 14 14 15 15 16 16 17 17 18 18 19 19 20 20 21 21]  [0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1]
   291         0           273       64      8        [26 27 28 29 30 31 32 33]           [0 0 0 0 0 0 0 0]
   292         0           100       64     16        [18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33]  [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]                   
   293         10          100       64     16        [ 8  8  9  9 12 12 13 13 34 34 35 35 40 40 42 42]  [0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1]                   
   294         200         73        64     16        [ 7  7 10 10 11 11 14 14 15 15 16 16 17 17 38 38]  [0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1]   
%   UEGRP#      startPrb    nPrb      nRxAnt nBfLayers         ueIdxs               ueLayersIdxs
   295         68          205       64     8         [ 6  7  8  9 10 11 12 13]  [0 0 0 0 0 0 0 0]
   296         20          62        64     16        [ 6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21]  [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   297         82          62        64     16        [22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37]  [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   298         144         64        64     16        [38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53]  [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   299         208         65        64     16        [54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69]  [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   300         26          235       64     8         [14 15 16 17 18 19 20 21]  [0 0 0 0 0 0 0 0]
   301         0           68        64     16        [ 6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21]  [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   302         68          68        64     16        [22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37]  [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   303         136         68        64     16        [38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53]  [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   304         204         69        64     16        [54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69]  [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   305         90          183       64     8         [ 6  7  8  9 10 11 12 13]  [0 0 0 0 0 0 0 0]
   306         0           66        64     16        [ 6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21]  [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   307         66          66        64     16        [22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37]  [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   308         132         66        64     16        [38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53]  [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   309         198         67        64     16        [54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69]  [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   310         26          247       64     8         [14 15 16 17 18 19 20 21]  [0 0 0 0 0 0 0 0]
   311         20          253       64     32        [ 6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37]  [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   312         0           273       64     32        [ 6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37]  [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   313         0           265       64     32        [ 6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37]  [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
   314         36          237       64     8         [ 6  7  8  9 10 11 12 13]  [0 0 0 0 0 0 0 0]
   315         15          246       64     8         [ 14 15 16 17 18 19 20 21]  [0 0 0 0 0 0 0 0]
   316         47          226       64     8         [ 6  7  8  9 10 11 12 13]  [0 0 0 0 0 0 0 0]
   317         15          258       64     8         [ 14 15 16 17 18 19 20 21]  [0 0 0 0 0 0 0 0]
%   UEGRP#      startPrb    nPrb      nRxAnt nBfLayers         ueIdxs               ueLayersIdxs
   % PUSCH set 0
   318         26          70        64     8         [ 6  7  8  9 10 11 12 13]  [0 0 0 0 0 0 0 0]
   319         96          40        64     4         [14 15 16 17         ]  [0 0 0 0]
   320         136         40        64     4         [18 19 20 21         ]  [0 0 0 0]
   321         176         24        64     1         [22                  ]  [0]
   322         200         24        64     1         [23                  ]  [0]
   323         224         24        64     1         [24                  ]  [0]
   324         248         25        64     1         [25                  ]  [0]
   % PDSCH set 0
   325         20          76        64     16        [ 6  6  7  7  8  8  9  9 10 10 11 11 12 12 13 13]  [0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1]
   326         96          40        64     8         [14 14 15 15 16 16 17 17]  [0 1 0 1 0 1 0 1]
   327         136         40        64     8         [18 18 19 19 20 20 21 21]  [0 1 0 1 0 1 0 1]
   328         176         24        64     2         [22 22               ]  [0 1]
   329         200         24        64     2         [23 23               ]  [0 1]
   330         224         24        64     2         [24 24               ]  [0 1]
   331         248         25        64     2         [25 25               ]  [0 1]
   % PUSCH set 1
   332         10          86        64     8         [26 27 28 29 30 31 32 33]  [0 0 0 0 0 0 0 0]
   333         96          40        64     4         [34 35 36 37         ]  [0 0 0 0]
   334         136         40        64     4         [38 39 40 41         ]  [0 0 0 0]
   335         176         24        64     1         [42                  ]  [0]
   336         200         24        64     1         [43                  ]  [0]
   337         224         24        64     1         [44                  ]  [0]
   338         248         14        64     1         [45                  ]  [0]
   % PDSCH set 1
   % reuse cfg 326~331 from PDSCH set 0
   339         0           96        64     16        [ 6  6  7  7  8  8  9  9 10 10 11 11 12 12 13 13]  [0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1]
   % PUSCH set 2
   % reuse cfg 332~337 from PUSCH set 1
   340         248         25        64     1         [45                  ]  [0]
   % PDSCH set 4
   % reuse cfg 339 from PDSCH set 1, cfg 326~330 from PDSCH set 0
   341         248         17        64     2         [25 25               ]  [0 1]
%   UEGRP#      startPrb    nPrb      nRxAnt nBfLayers         ueIdxs               ueLayersIdxs
   % PUSCH set 0
   342         26          70        64     4         [ 6  7  8  9         ]  [0 0 0 0]
   343         96          40        64     2         [10 11               ]  [0 0]
   344         136         40        64     2         [12 13               ]  [0 0]
   345         176         24        64     1         [14                  ]  [0]
   346         200         24        64     1         [15                  ]  [0]
   347         224         24        64     1         [16                  ]  [0]
   348         248         25        64     1         [17                  ]  [0]
   % PDSCH set 0
   349         20          76        64     16        [ 6  6  7  7  8  8  9  9 10 10 11 11 12 12 13 13]  [0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1]
   350         96          40        64     4         [14 14 15 15         ]  [0 1 0 1]
   351         136         40        64     4         [16 16 17 17         ]  [0 1 0 1]
   352         176         24        64     1         [18                  ]  [0]
   353         200         24        64     1         [19                  ]  [0]
   354         224         24        64     1         [20                  ]  [0]
   355         248         25        64     1         [21                  ]  [0]
   % PUSCH set 1
   356         10          86        64     4         [18 19 20 21         ]  [0 0 0 0]
   357         96          40        64     2         [22 23               ]  [0 0]
   358         136         40        64     2         [24 25               ]  [0 0]
   359         176         24        64     1         [26                  ]  [0]
   360         200         24        64     1         [27                  ]  [0]
   361         224         24        64     1         [28                  ]  [0]
   362         248         14        64     1         [29                  ]  [0]
   % PDSCH set 1
   % reuse cfg 350~355 from PDSCH set 0
   363         0           96        64     16        [ 6  6  7  7  8  8  9  9 10 10 11 11 12 12 13 13]  [0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1]
   % PUSCH set 2
   % reuse cfg 356~361 from PUSCH set 1
   364         248         25        64     1         [29                  ]  [0]
   % PDSCH set 4
   % reuse cfg 363 from PDSCH set 1, cfg 350~354 from PDSCH set 0
   365         248         17        64     1         [21                  ]  [0]
   };

CFG = {...
% GFG#  nUeGrps ueGrpIdxs chEstBufCfg lambda     noise_dB       srsPrbGrpSize   bfwPrbGrpSize
  9000    1       0          0           0            -30       2               2               % TC 0-4: 137 x 32 x 8. Vary how layers divided amonng the UEs.  
  9001    1       1          0           0            -30       2               2              
  9002    1       2          0           0            -30       2               2              
  9003    1       3          0           0            -30       2               2              
  9004    1       4          0           0            -30       2               2              
  9005    1       5          0           0            -30       2               2                % TC 5-9. v x 32 x 8. Vary number of PrbGrps
  9006    1       6          0           0            -30       2               2              
  9007    1       7          0           0            -30       2               2              
  9008    1       8          0           0            -30       2               2
  9009    1       9          0           0            -30       2               2
  9010    1       10         0           0            -30       2               2       % TC 10-14. 16 x 32 x 8. Vary start PrbGrp.
  9011    1       11         0           0            -30       2               2
  9012    1       12         0           0            -30       2               2
  9013    1       13         0           0            -30       2               2
  9014    1       14         0           0            -30       2               2
  9015    1       15         0           0            -30       2               2       % TC 15-19. 16 x 32 x v. Vary number of layers (8,4,2,1).
  9016    1       16         0           0            -30       2               2
  9017    1       17         0           0            -30       2               2
  9018    1       18         0           0            -30       2               2
  9019    1       19         0           0            -30       2               2
  9020    1       15         0           10^(-3.0)    -30       2               2      % TC 20-24. 16 x 32 x v. Vary normalization
  9021    1       16         0           10^(-2.7)    -30       2               2
  9022    1       17         0           10^(-2.5)    -30       2               2
  9023    1       18         0           10^(-2.3)    -30       2               2
  9024    1       19         0           10^(-2.0)    -30       2               2
  9025    1       20         0           0            -30       2               2      % TC 25-29. 32 x 32 x 4. Test prbGrp indexing
  9026    1       21         0           0            -30       2               2
  9027    1       22         0           0            -30       2               2
  9028    1       23         0           0            -30       2               2
  9029    1       24         0           0            -30       2               2
  9030    2       [0 1]      0           0            -30       2               2    % TC 30. 2 UE grps, same layers, prb sizes, start prb
  9031    2       [3 7]      0           0            -30       2               2    % TC 31. 2 UE grps. Different prb sizes.
  9032    2       [10 11]    0           0            -30       2               2    % TC 32. 2 UE grps. Different start prbs.
  9033    2       [15 18]    0           0            -30       2               2    % TC 33. 2 UE grps. Different layers.
  9034    2       [0 21]     0           0            -30       2               2    % TC 34. 2 UE grps. All prms different
  9035    4       [14 15 17 19] 0        0            -30       2               2    % TC 35. 4 UE grps. all different layers.
  9036    8       [0 3 5 7 10 11 12 13] 0 0           -30       2               2    % TC 36. 8 UE grps. 
  9037    16      [9:24]     0            0           -30       2               2    % TC 37. 16 UE grps.
  9038    1       49        20           0            -30       2               2    % TC 38-45: 64 antennas, vary layers 1-8
  9039    1       50        20           0            -30       2               2 
  9040    1       51        20           0            -30       2               2 
  9041    1       52        20           0            -30       2               2 
  9042    1       53        20           0            -30       2               2 
  9043    1       54        20           0            -30       2               2 
  9044    1       55        20           0            -30       2               2 
  9045    1       56        20           0            -30       2               2 
  9046    1       57        20           0            -30       2               2    % TC 46-53: 64 antennas, vary layers 9-16
  9047    1       58        20           0            -30       2               2
  9048    1       59        20           0            -30       2               2
  9049    1       60        20           0            -30       2               2
  9050    1       61        20           0            -30       2               2
  9051    1       62        20           0            -30       2               2
  9052    1       63        20           0            -30       2               2
  9053    1       64        20           0            -30       2               2
  9054    1       183       24           0            -30       2               2   % TC 54-59: users have different channel gains
  9055    1       184       24           0            -30       2               2
  9056    1       185       24           0            -40       2               2
  9057    1       186       24           0            -40       2               2
  9058    1       187       24           0            -30       2               2
  9059    1       188       24           0            -30       2               2
 
  
  9100    1        25        0           0             -30       2               2    % TC 100 - 109.  wideband.
  9101    1        26        0           0             -30       2               2
  9102    1        27        0           0             -30       2               2
  9103    1        28        0           0             -30       2               2
  9104    1        29        0           0             -30       2               2
  9105    1        30        0           0             -30       2               2
  9106    1        31        0           0             -30       2               2
  9107    1        32        0           0             -30       2               2
  9108    1        33        0           0             -30       2               2
  9109    1        34        0           0             -30       2               2
  9110    2        [35 44]   0           0             -30       2               2    % TC 110 - 119.  SIB1.
  9111    2        [35 43]   0           0             -30       2               2
  9112    2        [36 42]   0           0             -30       2               2
  9113    2        [36 41]   0           0             -30       2               2
  9114    2        [37 40]   0           0             -30       2               2
  9115    2        [37 44]   0           0             -30       2               2
  9116    2        [38 43]   0           0             -30       2               2
  9117    2        [38 42]   0           0             -30       2               2
  9118    2        [39 41]   0           0             -30       2               2
  9119    2        [39 40]   0           0             -30       2               2
  9220    1        45        0           0             -30       2               2   % TC 220-224. 16 x 32 x v. Vary number of layers (7,6,5,3).
  9221    1        46        0           0             -30       2               2
  9222    1        47        0           0             -30       2               2
  9223    1        48        0           0             -30       2               2
  9224    1        49        0           0             -30       2               2
  
  9226    1        0          0           0            -30       2               2    % same as 9000 but combined with SRS 8412 (runs 8412 first to match SRS buffer samples)  
  9227    1        1          0           0            -30       2               2    % same as 9001 but combined with SRS 8418 (runs 8418 first to match SRS buffer samples)
  
  9228    1       65          1           0            -30       2               2    % same as 9000 but 30 MHz
  9229    1       66          1           0            -30       2               2    % same as 9001 but 30 MHz
  9230    1       67          2           0            -30       2               2    % same as 9000 but 50 MHz
  9231    1       68          2           0            -30       2               2    % same as 9001 but 50 MHz
  
  9234    1       69          0           0            -30       2               2    % same as 9000 but partial allocation
  9235    1       70          0           0            -30       2               2    % same as 9001 but partial allocation
  
  9236    1       71          20           0           -30       2               2    % 16 layers (16UEx1) DL same as 9000 but combined with SRS XXXX and 64TR
  9237    1       49          20           0           -30       2               2    % 8 layers (8UEx1) UL same as 9000 but combined with SRS XXXX and 64TR
  9238    1       56          20           0           -30       2               2    % 1 layers DL (1) same as 9000 but combined with SRS XXXX and 64TR
  9239    1       56          20           0           -30       2               2    % 1 layer UL (1)
  9240    1       72          20           0           -30       2               2    % 2 layer DL (2)  
  9241    1       72          20           0           -30       2               2    % 2 layer UL (2)
  9242    1       73          20           0           -30       2               2    % 2 layer DL (1+1)
  9243    1       73          20           0           -30       2               2    % 2 layer UL (1+1)
  9244    1       75          20           0           -30       2               2    % 4 layer DL (2+2)
  9245    1       75          20           0           -30       2               2    % 4 layer UL (2+2)
  9246    1       74          20           0           -30       2               2    % 4 layer DL (1+1+1+1)
  9247    1       74          20           0           -30       2               2    % 4 layer UL (1+1+1+1)
  9248    1       76          20           0           -30       2               2    % 8 layer DL (2+2+2+2)
  9249    1       74          20           0           -30       2               2    % 4 layer UL (1+1+1+1)
  9250    1       77          20           0           -30       2               2    % 2 layer DL (2)
  9251    1       77          20           0           -30       2               2    % 2 layer UL (2)
  9252    1       78          20           0           -30       2               2    % 2 layer DL (2)
  9253    1       78          20           0           -30       2               2    % 2 layer UL (2)
  9254    1       79          20           0           -30       2               2    % 2 layer DL (2)
  9255    1       79          20           0           -30       2               2    % 2 layer UL (2)
  9256    1       80          22           0           -30       4               4    % prgSize 4
  9257    1       80          22           0           -30       4               4    % prgSize 4
  %
  9259    1       49          20           0           -30       2               2    %  8 layer UL (1+1+1+1+1+1+1+1)
  9260    1       81          20           0           -30       2               2    % 16 layer DL (2+2+2+2+2+2+2+2)
  9261    1       76          20           0           -30       2               2    %  8 layer UL (2+2+2+2)
  9262    1       82          20           0           -30       2               2    % 16 layer DL (4+4+4+4)
  9263    1       83          20           0           -30       2               2    %  4 layer UL Partial PRB allocation
  9264    1       84          20           0           -30       2               2    %  8 layer DL Partial PRB allocation
  9265    2       [104 103]   20           0           -30       2               2    %  UL 2 UE Groups, same layers, prb sizes, start prb
  9266    2       [85 86]     20           0           -30       2               2    %  DL 2 UE Groups, same layers, prb sizes, start prb
  9267    2       [113 105]   20           0           -30       2               2    %  UL 2 UE Groups, different prb sizes
  9268    2       [85 87]     20           0           -30       2               2    %  DL 2 UE Groups, different prb sizes
  9269    2       [114 106]   20           0           -30       2               2    %  UL 2 UE Groups, different start PRBs
  9270    2       [85 88]     20           0           -30       2               2    %  DL 2 UE Groups, different start PRBs
  9271    2       [114 107]   20           0           -30       2               2    %  UL 2 UE Groups, different layers
  9272    2       [89 90]     20           0           -30       2               2    %  DL 2 UE Groups, different layers
  9273    2       [93 108]    20           0           -30       2               2    %  UL 2 UE Groups, all diff params
  9274    2       [89 91]     20           0           -30       2               2    %  DL 2 UE Groups, all diff params
  9275    4       [98 109 115 99] 20       0           -30       2               2    %  UL 4 UE Groups, all diff layers
  9276    4       [92 93 94 95] 20         0           -30       2               2    %  DL 4 UE Groups, all diff layers
  9277    8       [98 116 118 117 110 111 112 119] 20 0 -30      2               2    %  UL 8 UE groups
  9278    8       [120 96 97 98 99 100 101 102] 20 0   -30       2               2    %  DL 8 UE groups
  9279    2       [126 127]   20           0           -30       2               2    %  ULMIX 3 UE groups (2 dynamic BF)
  9280    2       [121 122]   20           0           -30       2               2    %  DLMIX 3 UE groups (2 dynamic BF)
  9281    2       [129 127]   20           0           -30       2               2    %  ULMIX 2 UE groups
  9282    2       [124 125]   20           0           -30       2               2    %  DLMIX 2 UE groups
  9283    1       [129]       20           0           -30       2               2    %  ULMIX 1 UE groups
  9284    1       [124]       20           0           -30       2               2    %  DLMIX 1 UE groups
  9285    1       [132]       20           0           -30       2               2    %  ULMIX 1 UE groups
  9286    1       [131]       20           0           -30       2               2    %  DLMIX 1 UE groups
  9287    1       [129]       20           0            -30       2               2    %  ULMIX 1 UE groups (1 UE x 2 layer)
  9288    1       [169]       20           0            -30       2               2    %  DLMIX 1 UE groups (8 UE x 1 layer)
  %
  9290    1       [170]       23           0            -30       2               2    %  DLMIX 1 UE group (8 UE x 1 layer)
  %
  9292    1       [171]       23           0            -30       2               2    %  DLMIX 1 UE group (2 UE)
  %
  9294    2       [172 173]   20           0            -30       2               2    %  DLMIX 2 UE group (mix of UE layers)
  %
  9296    1       76          20           0           -30       2               273  % 8 layer DL (2+2+2+2)
  9300    1       130         1           0            -30       1               2    % SRS PRG-size 1, BFW PRG-size 2
  9301    1       130         1           0            -30       1               4    % SRS PRG-size 1, BFW PRG-size 4
  9302    1       130         1           0            -30       1               32   % SRS PRG-size 1, BFW PRG-size 137
  9303    1       130         1           0            -30       2               4    % SRS PRG-size 2, BFW PRG-size 4
  9304    1       130         1           0            -30       2               32   % SRS PRG-size 2, BFW PRG-size 273
  9305    1       130         1           0            -30       4               32   % SRS PRG-size 4, BFW PRG-size 156
  9306    1       133         20          0            -30       2                4   % SRS PRG-size 2, BFW PRG-size 4
  9307    1       133         20          0            -30       2               64   % SRS PRG-size 2, BFW PRG-size 32
  %
  9309    2       [126 127]   20           0           -30       2               2    %  ULMIX 3 UE groups (2 dynamic BF) 2nd Cell
  9310    2       [121 122]   20           0           -30       2               2    %  DLMIX 3 UE groups (2 dynamic BF) 2nd Cell  
  9311    2       [126 127]   20           0           -30       2               2    %  ULMIX 3 UE groups (2 dynamic BF) 2nd Cell
  9312    2       [121 122]   20           0           -30       2               2    %  DLMIX 3 UE groups (2 dynamic BF) 2nd Cell
  9313    2       [126 127]   20           0           -30       2               2    %  ULMIX 3 UE groups (2 dynamic BF) 2nd Cell
  9314    2       [121 122]   20           0           -30       2               2    %  DLMIX 3 UE groups (2 dynamic BF) 2nd Cell
  9315    2       [126 127]   20           0           -30       2               2    %  ULMIX 3 UE groups (2 dynamic BF) 2nd Cell
  9316    2       [121 122]   20           0           -30       2               2    %  DLMIX 3 UE groups (2 dynamic BF) 2nd Cell
  9317    2       [126 127]   20           0           -30       2               2    %  ULMIX 3 UE groups (2 dynamic BF) 2nd Cell
  9318    2       [121 122]   20           0           -30       2               2    %  DLMIX 3 UE groups (2 dynamic BF) 2nd Cell
  9319    2       [126 127]   20           0           -30       2               2    %  ULMIX 3 UE groups (2 dynamic BF) 2nd Cell
  9320    2       [121 122]   20           0           -30       2               2    %  DLMIX 3 UE groups (2 dynamic BF) 2nd Cell
  9321    2       [126 127]   20           0           -30       2               2    %  ULMIX 3 UE groups (2 dynamic BF) 2nd Cell
  9322    2       [121 122]   20           0           -30       2               2    %  DLMIX 3 UE groups (2 dynamic BF) 2nd Cell
  9323    2       [126 127]   20           0           -30       2               2    %  ULMIX 3 UE groups (2 dynamic BF) 2nd Cell
  9324    2       [121 122]   20           0           -30       2               2    %  DLMIX 3 UE groups (2 dynamic BF) 2nd Cell
  9325    2       [126 127]   20           0           -30       2               2    %  ULMIX 3 UE groups (2 dynamic BF) 2nd Cell
  9326    2       [121 122]   20           0           -30       2               2    %  DLMIX 3 UE groups (2 dynamic BF) 2nd Cell
  9327    2       [126 127]   20           0           -30       2               2    %  ULMIX 3 UE groups (2 dynamic BF) 2nd Cell
  9328    2       [121 122]   20           0           -30       2               2    %  DLMIX 3 UE groups (2 dynamic BF) 2nd Cell

  % 64TR MU-MIMO, 3 peak cells, 1 UEG, 16 UEs, 1 layer per UE
  % GFG#  nUeGrps ueGrpIdxs chEstBufCfg lambda     noise_dB       srsPrbGrpSize   bfwPrbGrpSize
  9329    1        179         20           0           -30       2               2    %  ULMIX 1 UE group (dynamic BF), cell-id 41
  9330    1        180         20           0           -30       2               2    %  DLMIX 1 UE group (dynamic BF), cell-id 41
  9331    1        179         20           0           -30       2               2    %  ULMIX 1 UE group (dynamic BF), cell-id 42
  9332    1        180         20           0           -30       2               2    %  DLMIX 1 UE group (dynamic BF), cell-id 42
  9333    1        179         20           0           -30       2               2    %  ULMIX 1 UE group (dynamic BF), cell-id 43
  9334    1        180         20           0           -30       2               2    %  DLMIX 1 UE group (dynamic BF), cell-id 43
  % 64TR MU-MIMO, 3 peak cells, 1 UEG, 8 UEs, 2 layers per UE
  % GFG#  nUeGrps ueGrpIdxs chEstBufCfg lambda     noise_dB       srsPrbGrpSize   bfwPrbGrpSize
  9335    1        181         20           0           -30       2               2    %  ULMIX 1 UE group (dynamic BF), cell-id 41
  9336    1        182         20           0           -30       2               2    %  DLMIX 1 UE group (dynamic BF), cell-id 41
  9337    1        181         20           0           -30       2               2    %  ULMIX 1 UE group (dynamic BF), cell-id 42
  9338    1        182         20           0           -30       2               2    %  DLMIX 1 UE group (dynamic BF), cell-id 42
  9339    1        181         20           0           -30       2               2    %  ULMIX 1 UE group (dynamic BF), cell-id 43
  9340    1        182         20           0           -30       2               2    %  DLMIX 1 UE group (dynamic BF), cell-id 43
  %
  9342    1       [170]       23           0            -30       2               2    %  DLMIX 1 UE group (8 UE x 1 layer), BFPforCuphy = 9
  %
  9344    1       [171]       23           0            -30       2               2    %  DLMIX 1 UE group (2 UE), BFPforCuphy = 9
  %
  9346    1       [170]       23           0            -30       2               2    %  DLMIX 1 UE group (8 UE x 1 layer), 4 SRS symbols
  %
  9348    1       [171]       23           0            -30       2               2    %  DLMIX 1 UE group (2 UE), 4 SRS symbols
  9350    1       [189]       23           0            -30       2               2    %  DLMIX 1 UE group (8 UE x 1 layers, 273 PRBs)
  9352    1       [190]       23           0            -30       2               2    %  DLMIX 1 UE group (4 UE x 2 layers, 273 PRBs)
  9354    1       [191]       23           0            -30       2               2    %  DLMIX 1 UE group (8 UE x 1 layers, 253 PRBs)
  9355    1       [193]       23           0            -30       2               2    %  ULMIX 21525 MIMO (8UE x 1 Layer)
  9356    1       [192]       23           0            -30       2               2    %  DLMIX 21576-20599 MIMO (16UE x 1 Layer)
  9357    1       [194]       23           0            -30       2               2    %  ULMIX 21524 MIMO (8UE x 1 Layer)
  9358    1       [195]       23           0            -30       2               2    %  DLMIX 1 UE group (8 UE x 1 layers, 136 PRBs)
  9360    1       [196]       23           0            -30       2               2    %  DLMIX 1 UE group (4 UE x 2 layers, 136 PRBs)
  9362    1       [197]       23           0            -30       2               2    %  DLMIX 1 UE group (8 UE x 1 layers, 116 PRBs)
  9364    1       [198]       23           0            -30       2               2    %  DLMIX 1 UE group (16 UE x 1 layers, 253 PRBs, 20~272)
  9365    1       [199]       23           0            -30       2               2    %  ULMIX 1 UE group (8UE x 1 Layer, 247 PRBs, 26~272)
  9366    1       [192]       23           0            -30       2               2    %  DLMIX 1 UE group (16 UE x 1 Layers, 273 PRBs, 0~272)
  9367    1       [200]       23           0            -30       2               2    %  ULMIX 1 UE group (8UE x 1 Layer, 215 PRBs, 10~224)
  9368    1       [198]       23           0            -30       2               2    %  DLMIX 1 UE group (16 UE x 1 layers, 253 PRBs, 20~272)
  % 64TR 40 MHz
  9369    1       [201]       25           0            -30       2               2    %  ULMIX 21584/21594 MIMO (8UE x 1 Layer)
  9370    1       [202]       25           0            -30       2               2    %  DLMIX 20640-20642 MIMO (16UE x 1 Layer)
  9371    1       [203]       25           0            -30       2               2    %  ULMIX 21585/21595 MIMO (8UE x 1 Layer)
  9372    1       [204]       25           0            -30       2               2    %  DLMIX 20643-20679 MIMO (16UE x 1 Layer)
  % 64TR 4 UEGs, 2 UEs per UEG, 1 layer per UE
  9373    4       [205:208]   23           0            -30       2               2    %  Adapted from ULMIX 21524 MIMO but (2UE x 1 Layer)
  9375    4       [209:212]   23           0            -30       2               2    %  Adapted from ULMIX 21525 MIMO but (2UE x 1 Layer)
  % 64TR 2 UEGs, 4 UEs per UEG, 1 layer per UE
  9377    2       [213:214]   23           0            -30       2               2    %  Adapted from ULMIX 21524 MIMO but (4UE x 1 Layer)
  9379    2       [215:216]   23           0            -30       2               2    %  Adapted from ULMIX 21525 MIMO but (4UE x 1 Layer)  
  % 64TR 64 UEs per TTI
  9381    16      [217:232]   26           0            -30       2               2    % ULMIX 16 UE groups (4 UE x 2 Layer)
  9382    8       [233:240]   26           0            -30       2               2    % DLMIX 8  UE groups (8 UE x 2 Layer)
  9383    16      [241:256]   26           0            -30       2               2    % ULMIX 16 UE groups (4 UE x 2 Layer)
  9384    8       [257:264]   26           0            -30       2               2    % DLMIX 8  UE groups (8 UE x 2 Layer)
  % 64TR, column I
  9385    2       [265:266]   23           0            -30       2               2    % ULMIX 2 UE groups (4 UE x 1 Layer)              
  9386    1       [267]       23           0            -30       2               2    % DLMIX 1 UE group (16 UE x 1 Layer)              
  9387    2       [268:269]   23           0            -30       2               2    % ULMIX 2 UE groups (4 UE x 1 Layer)              
  9388    1       [270]       23           0            -30       2               2    % DLMIX 1 UE group (16 UE x 1 Layer)              
  9390    1       [271]       23           0            -30       2               2    % DLMIX 1 UE group (16 UE x 1 Layer)  
  % 64TR, Ph4 column B
  9391    1       [272]       23           0            -30       2               2    % ULMIX 1 UE group (8 UE x 1 Layer)              
  9392    1       [273]       23           0            -30       2               2    % DLMIX 1 UE group (16 UE x 1 Layer)              
  9393    1       [274]       23           0            -30       2               2    % ULMIX 1 UE group (8 UE x 1 Layer)             
  9394    1       [275]       23           0            -30       2               2    % DLMIX 1 UE group (16 UE x 1 Layer)
  9395    1       [280]       23           0            -30       2               2    % ULMIX 1 UE group (8 UE x 1 Layer)
  9396    1       [276]       23           0            -30       2               2    % DLMIX 1 UE group (16 UE x 1 Layer)  
  % 64TR heterogeneous pattern
  9398    4       [285:288]   20           0            -30       2               2    % DLMIX 4 UE group (4 UEGs x 4 Layer)
  9400    4       [281:284]   20           0            -30       2               2    % DLMIX 4 UE group (4 UE x 4 Layer, 3x2, 2x2,2x1)
  % 64TR 25-3 column B, 4 SRS symbols in S slot
  9401    1       [272]       23           0            -30       2               2    % ULMIX 1 UE group (8 UE x 1 Layer)              
  9402    1       [273]       23           0            -30       2               2    % DLMIX 1 UE group (16 UE x 1 Layer)              
  9403    1       [274]       23           0            -30       2               2    % ULMIX 1 UE group (8 UE x 1 Layer)             
  9404    1       [275]       23           0            -30       2               2    % DLMIX 1 UE group (16 UE x 1 Layer)
  9405    1       [280]       23           0            -30       2               2    % ULMIX 1 UE group (8 UE x 1 Layer)
  9406    1       [276]       23           0            -30       2               2    % DLMIX 1 UE group (16 UE x 1 Layer) 
  % 64TR 25-3 column B, 2 SRS symbols in S slot, 1 SRS symbol in each U slot
  9407    1       [272]       23           0            -30       2               2    % ULMIX 1 UE group (8 UE x 1 Layer)              
  9408    1       [273]       23           0            -30       2               2    % DLMIX 1 UE group (16 UE x 1 Layer)              
  9409    1       [274]       23           0            -30       2               2    % ULMIX 1 UE group (8 UE x 1 Layer)             
  9410    1       [275]       23           0            -30       2               2    % DLMIX 1 UE group (16 UE x 1 Layer)
  9411    1       [280]       23           0            -30       2               2    % ULMIX 1 UE group (8 UE x 1 Layer)
  9412    1       [276]       23           0            -30       2               2    % DLMIX 1 UE group (16 UE x 1 Layer) 
  % 64TR 25-3 column G, 64 UEs per TTI, 4 SRS symbols in S slot
  9413    1       [295]       26           0            -30       2               2    % ULMIX 1 UE group (1 UEG x 8 Layer)
  9414    1       [296:299]   26           0            -30       2               2    % DLMIX 4 UE group (4 UEG x 16 Layer)
  9415    1       [300]       26           0            -30       2               2    % ULMIX 1 UE group (1 UEG x 8 Layer)
  9416    1       [301:304]   26           0            -30       2               2    % DLMIX 4 UE group (4 UEG x 16 Layer)
  9417    1       [305]       26           0            -30       2               2    % ULMIX 1 UE group (1 UEG x 8 Layer)
  9418    1       [306:309]   26           0            -30       2               2    % DLMIX 4 UE group (4 UEG x 16 Layer)
  9419    1       [310]       26           0            -30       2               2    % ULMIX 1 UE group (1 UEG x 8 Layer)
  % 64TR 25-3 column G, 64 UEs per TTI, 2 SRS symbols in S slot, 1 SRS symbol in each U slot
  9421    1       [295]       26           0            -30       2               2    % ULMIX 1 UE group (1 UEG x 8 Layer)
  9422    1       [296:299]   26           0            -30       2               2    % DLMIX 4 UE group (4 UEG x 16 Layer)
  9423    1       [300]       26           0            -30       2               2    % ULMIX 1 UE group (1 UEG x 8 Layer)
  9424    1       [301:304]   26           0            -30       2               2    % DLMIX 4 UE group (4 UEG x 16 Layer)
  9425    1       [305]       26           0            -30       2               2    % ULMIX 1 UE group (1 UEG x 8 Layer)
  9426    1       [306:309]   26           0            -30       2               2    % DLMIX 4 UE group (4 UEG x 16 Layer)
  9427    1       [310]       26           0            -30       2               2    % ULMIX 1 UE group (1 UEG x 8 Layer)
  % 64TR 25-3 column E, 4 SRS symbols in S slot reuse 9401/9403/9405 for UL
  9430    1       [311]       27           0            -30       2               2    % DLMIX 1 UE group (32 UE x 1 Layer)
  9432    1       [312]       27           0            -30       2               2    % DLMIX 1 UE group (32 UE x 1 Layer)
  9434    1       [313]       27           0            -30       2               2    % DLMIX 1 UE group (32 UE x 1 Layer) 
  9429    1       [314]       27           0            -30       2               2    % ULMIX 1 UE group (8 UE x 1 Layer)  
  9431    1       [315]       27           0            -30       2               2    % ULMIX 1 UE group (8 UE x 1 Layer)              
  9433    1       [316]       27           0            -30       2               2    % ULMIX 1 UE group (8 UE x 1 Layer)              
  9435    1       [317]       27           0            -30       2               2    % ULMIX 1 UE group (8 UE x 1 Layer)                          
  % 64TR, Ph4 column B, srsPrgSize = 4, bfwPrgSize = 16
  9437    1       [272]       28           0            -30       4              16    % ULMIX 1 UE group (8 UE x 1 Layer)              
  9438    1       [273]       28           0            -30       4              16    % DLMIX 1 UE group (16 UE x 1 Layer)              
  9439    1       [274]       28           0            -30       4              16    % ULMIX 1 UE group (8 UE x 1 Layer)             
  9440    1       [275]       28           0            -30       4              16    % DLMIX 1 UE group (16 UE x 1 Layer)
  9441    1       [280]       28           0            -30       4              16    % ULMIX 1 UE group (8 UE x 1 Layer)
  9442    1       [276]       28           0            -30       4              16    % DLMIX 1 UE group (16 UE x 1 Layer) 
  % 64TR, Ph4 column B, srsPrgSize = 2, bfwPrgSize = 16
  9443    1       [272]       23           0            -30       2              16    % ULMIX 1 UE group (8 UE x 1 Layer)              
  9444    1       [273]       23           0            -30       2              16    % DLMIX 1 UE group (16 UE x 1 Layer)              
  9445    1       [274]       23           0            -30       2              16    % ULMIX 1 UE group (8 UE x 1 Layer)             
  9446    1       [275]       23           0            -30       2              16    % DLMIX 1 UE group (16 UE x 1 Layer)
  9447    1       [280]       23           0            -30       2              16    % ULMIX 1 UE group (8 UE x 1 Layer)
  9448    1       [276]       23           0            -30       2              16    % DLMIX 1 UE group (16 UE x 1 Layer) 
  % 64TR MU-MIMO realistic traffic with Center/Middle/Edge, 100 MHz heavy
% CFG#    nUeGrps ueGrpIdxs            chEstBufCfg lambda      noise_dB       srsPrbGrpSize   bfwPrbGrpSize
  9449    7       [318:324]            29           0          -30            2               2              
  9450    7       [325:331]            29           0          -30            2               2              
  9451    7       [332:338]            29           0          -30            2               2              
  9452    7       [326:331, 339]       29           0          -30            2               2              
  9453    7       [332:337, 340]       29           0          -30            2               2              
  9454    7       [326:330, 339, 341]  29           0          -30            2               2                       
  % 64TR MU-MIMO realistic traffic with Center/Middle/Edge, 100 MHz light
% CFG#    nUeGrps ueGrpIdxs            chEstBufCfg lambda      noise_dB       srsPrbGrpSize   bfwPrbGrpSize
  9455    7       [342:348]            29           0          -30            2               2              
  9456    7       [349:355]            29           0          -30            2               2              
  9457    7       [356:362]            29           0          -30            2               2              
  9458    7       [350:355, 363]       29           0          -30            2               2              
  9459    7       [356:361, 364]       29           0          -30            2               2              
  9460    7       [350:354, 363, 365]  29           0          -30            2               2                 
  % 64TR 25-3 column E, 2 SRS symbols in S slot, 1 SRS symbol in each U slot
  9462    1       [311]       27           0            -30       2               2    % DLMIX 1 UE group (32 UE x 1 Layer)
  9464    1       [312]       27           0            -30       2               2    % DLMIX 1 UE group (32 UE x 1 Layer)
  9466    1       [313]       27           0            -30       2               2    % DLMIX 1 UE group (32 UE x 1 Layer) 
  9461    1       [314]       27           0            -30       2               2    % ULMIX 1 UE group (8 UE x 1 Layer)  
  9463    1       [315]       27           0            -30       2               2    % ULMIX 1 UE group (8 UE x 1 Layer)              
  9465    1       [316]       27           0            -30       2               2    % ULMIX 1 UE group (8 UE x 1 Layer)              
  9467    1       [317]       27           0            -30       2               2    % ULMIX 1 UE group (8 UE x 1 Layer)  

  % 64TR perf
  % GFG#  nUeGrps ueGrpIdxs chEstBufCfg lambda     noise_dB       srsPrbGrpSize   bfwPrbGrpSize
  9800    7       [134:140]   20          0            -30       2               2    %  DLMIX
  9801    7       [141:147]   20          0            -30       2               2    %  DLMIX
  9802    7       [148:154]   20          0            -30       2               2    %  ULMIX
  9803    7       [155:161]   20          0            -30       2               2    %  ULMIX
  9804    7       [162:168]   20          0            -30       2               2    %  ULMIX
  % 64TR perf
  % GFG#  nUeGrps ueGrpIdxs chEstBufCfg lambda     noise_dB       srsPrbGrpSize   bfwPrbGrpSize
  9805    1       [174:174]   20          0            -30       2               2    %  DLMIX
  9806    1       [175:175]   20          0            -30       2               2    %  DLMIX
  9807    1       [176:176]   20          0            -30       2               2    %  ULMIX
  9808    1       [177:177]   20          0            -30       2               2    %  ULMIX
  9809    1       [178:178]   20          0            -30       2               2    %  ULMIX
  % different valid SRS CHEST
  9810    1       1           0           0            -30       2               2    %  same as 9001 but different valid SRS CHEST
  % nvbug 5368243
  9811    1       [277]       23          0            -30       2               2    %  non-sequential order of DMRS ports
  9812    1       [278]       23          0            -30       2               2    %  non-sequential order of DMRS ports
  9814    1       [279]       23          0            -30       2               2    %  non-sequential order of DMRS ports

  9816    1       [289]       27          0            -30       2               2    %  24 layers
  9818    1       [290]       27          0            -30       2               2    %  32 layers
  9819    1       [291]       26          0            -30       2               2    %  Test case with two SRS TVs (main)
  9820    1       [292:294]   26          0            -30       2               2    %  Test case with two SRS TVs (loadOnly)
}; 

% SRS BFW TV lookup table: [SRS_TV, non_loadOnly_TV, loadOnly_TVs, prgSize, N_ID_CELL]
% Structure: Each row represents a group, where:
%   Column 1: SRS TV number(s) - can be a single number or cell array of numbers for multiple SRS TVs
%   Column 2: Main (non-loadOnly) BFW TV number
%   Column 3: Cell array of loadOnly BFW TV numbers
%   Column 4: prgSize (empty if not applicable), same for all BFW TV numbers
%   Column 5: N_ID_CELL (empty if not applicable), same for all BFW TV numbers
%   will use individual TV number for different prgSize and N_ID_CELL cases
SRS_BFW_TV_LOOKUP = {
%   srsTV   mainTV  loadOnlyTV                            prgSize  N_ID_CELL
    8412,   9226,     {},                                   [],      [];
    8413,   9227,     {},                                   [],      [];
    8512,   9236,   {9237},                                 [],      [];
    8514,   9238,   {9239},                                 [],      [];
    8516,   9240,   {9241},                                 [],      [];
    8518,   9242,   {9243},                                 [],      [];
    8520,   9244,   {9245},                                 [],      [];
    8522,   9246,   {9247},                                 [],      [];
    8524,   9248,   {9249},                                 [],      [];
    8526,   9250,   {9251},                                 [],      [];
    8532,   9256,   {9257},                                 4,       [];
    8536,   9260,   {9259},                                 [],      [];
    8538,   9262,   {9261},                                 [],      [];
    8540,   9264,   {9263},                                 [],      [];
    8542,   9266,   {9265},                                 [],      [];
    8544,   9268,   {9267},                                 [],      [];
    8546,   9270,   {9269},                                 [],      [];
    8548,   9272,   {9271},                                 [],      [];
    8550,   9274,   {9273},                                 [],      [];
    8552,   9276,   {9275},                                 [],      [];
    8555,   9278,   {9277, 9294},                           [],      [];
    743,    9280,   {9279},                                 [],      [];
    763,    9284,   {9283},                                 [],      [];
    783,    9286,   {9285},                                 [],      [];
    803,    9288,   {9287},                                 [],      [];
    823,    9292,   {9290, 9350, 9352, 9354, 9358, 9360, 9362}, [],  [];
    8558,   9306,   {9307},                                 [],      [];
    21203,  9310,   {9309},                                 [],      41;
    21223,  9312,   {9311},                                 [],      42;
    21243,  9314,   {9313},                                 [],      43;
    21263,  9316,   {9315},                                 [],      44;
    21283,  9318,   {9317},                                 [],      45;
    21303,  9320,   {9319},                                 [],      46;
    21323,  9322,   {9321},                                 [],      47;
    21343,  9324,   {9323},                                 [],      48;
    21363,  9326,   {9325},                                 [],      49;
    21383,  9328,   {9327},                                 [],      50;
    21423,  9330,   {9329},                                 [],      41;
    21443,  9332,   {9331},                                 [],      42;
    21463,  9334,   {9333},                                 [],      43;
    21433,  9336,   {9335},                                 [],      41;
    21453,  9338,   {9337},                                 [],      42;
    21473,  9340,   {9339},                                 [],      43;
    843,    9344,   {9342},                                 [],      [];
    863,    9348,   {9346},                                 [],      [];
    21523,  9355,   {9356, 9357, 9364, 9373, 9375, 9377, 9379, 9811, 9812, 9814}, [],  [];
    21563,  9365,   {9366, 9367, 9368},                     [],      [];
    21583,  9369,   {9370, 9371, 9372},                     [],      [];
    21603,  9381,   {9382, 9383, 9384},                     [],      [];
    21623,  9385,   {9386, 9387, 9388, 9390},               [],      [];
    21643,  9391,   {9392, 9393, 9394, 9395, 9396},         [],      [];
    21663,  9400,   {}                                      [],      [];
    {21642, 21653}, 9819, {9820},                           [],      [];  % Example using two SRS TVs
    21673,  9401,   {9402, 9403, 9404, 9405, 9406, 9429, 9430, 9431, 9432, 9433, 9434, 9435, 9816, 9818},         [],      [];
    21693,  9407,   {9408, 9409, 9410, 9411, 9412},         [],      [];
    {21713,21723}, 9413, {9414, 9415, 9416, 9417, 9418, 9419},       [],      [];
    {21733,21734,21735,21743}, 9421, {9422, 9423, 9424, 9425, 9426, 9427}, [],      [];
    21773,  9437,   {9438, 9439, 9440, 9441, 9442},         16,      [];
    21772,  9443,   {9444, 9445, 9446, 9447, 9448},         16,      [];
    {21793,21803},  9449,   {9450, 9451, 9452, 9453, 9454}, [],      [];
    {21813,21823},  9455,   {9456, 9457, 9458, 9459, 9460}, [],      [];
    {21753, 21763}, 9461,   {9462, 9463, 9464, 9465, 9466, 9467},    [],      [];
};

% sanity check: mainTV and loadOnlyTV shouldn't have same BFW TV number
% Collect all mainTVs and loadOnlyTVs from the entire table
allMainTVs = [];
allLoadOnlyTVs = [];
for row = 1:size(SRS_BFW_TV_LOOKUP, 1)
    mainTV = SRS_BFW_TV_LOOKUP{row, 2};
    loadOnlyTVs = SRS_BFW_TV_LOOKUP{row, 3};
    
    if ~isempty(mainTV)
        allMainTVs = [allMainTVs, mainTV];
    end
    
    if ~isempty(loadOnlyTVs)
        allLoadOnlyTVs = [allLoadOnlyTVs, loadOnlyTVs{:}];
    end
end
% Check for conflicts between all mainTVs and all loadOnlyTVs
for i = 1:length(allMainTVs)
    for j = 1:length(allLoadOnlyTVs)
        if allMainTVs(i) == allLoadOnlyTVs(j)
            error('SRS_BFW_TV_LOOKUP sanity check failed: mainTV %d conflicts with loadOnlyTV %d across the entire table', ...
                allMainTVs(i), allLoadOnlyTVs(j));
        end
    end
end

% sanity check: SRS TV numbers in first column (mainTV) should be unique
% Collect all SRS TV numbers from the first column, handling both single numbers and cell arrays
allSrsTvs = [];
for row = 1:size(SRS_BFW_TV_LOOKUP, 1)
    srsTV = SRS_BFW_TV_LOOKUP{row, 1};
    
    if iscell(srsTV)
        % Handle cell array case (e.g., {21642, 21653})
        allSrsTvs = [allSrsTvs, srsTV{:}];
    else
        % Handle single number case
        allSrsTvs = [allSrsTvs, srsTV];
    end
end

% Check for duplicates in SRS TV numbers
uniqueSrsTvs = unique(allSrsTvs);
if length(allSrsTvs) ~= length(uniqueSrsTvs)
    % Find duplicates
    [sortedSrsTvs, ~] = sort(allSrsTvs);
    duplicateIdx = find(diff(sortedSrsTvs) == 0);
    if ~isempty(duplicateIdx)
        duplicateValues = sortedSrsTvs(duplicateIdx);
        error('SRS_BFW_TV_LOOKUP sanity check failed: Duplicate SRS main TV numbers found: %s', ...
            mat2str(unique(duplicateValues)));
    end
end

% Automatically generate bypass_TC from the lookup table
% These are loadOnly TCs that run through other TCs and should be bypassed in parallel execution
bypass_TC = [];
for row = 1:size(SRS_BFW_TV_LOOKUP, 1)
    loadonly_tvs = SRS_BFW_TV_LOOKUP{row, 3};
    if ~isempty(loadonly_tvs)
        bypass_TC = [bypass_TC, loadonly_tvs{:}];
    end
end
bypass_TC = sort(bypass_TC);
% exclude disabled_TC and bypass_TC from TcToTest if caseSet is a string
if ~isnumeric(caseSet)    
    TcToTest = setdiff(TcToTest,[disabled_TC,bypass_TC]);
end


[NallTest, ~] = size(CFG);
nCompErrs     = 0;
nCompChecks   = 0;
nTvGen        = 0;
detErr        = 0;

if (isnumeric(caseSet))
    caseSetStr = num2str(caseSet);
else
    caseSetStr = caseSet;
end
fprintf('BFW computation: genTV = %d, testCompliance = %d, caseSet = %s', genTV, testCompliance, caseSetStr);
fprintf('\nTC#   PASS\n');
fprintf('-----------\n');

parfor n = 1:NallTest 

    SRS_CHEST_BUFF_CFG = [];
    idxSet  = n;
    caseNum = CFG{idxSet, 1};
    if ismember(caseNum, TcToTest) && (mod(caseNum, subSetMod(2)) == subSetMod(1))
        rng(caseNum);
        nUeGrps        = CFG{idxSet, 2};
        ueGrpIdxs      = CFG{idxSet, 3};
        chEstBufIdx    = CFG{idxSet, 4};
        lambda         = CFG{idxSet, 5};
        noiseEnergy_dB = CFG{idxSet, 6};
        srsPrbGrpSize  = CFG{idxSet, 7};
        bfwPrbGrpSize  = CFG{idxSet, 8};
        
        testAlloc     = [];
        testAlloc.dl  = 1;
        testAlloc.ul  = 0;
        testAlloc.bfw = nUeGrps;
        
        SysPar = initSysPar(testAlloc);
        % Grid size corrections for smaller BW
        if ismember(caseNum, [9228 9229])
            SysPar.carrier.N_grid_size_mu = 78;
        elseif ismember(caseNum, [9230 9231])
            SysPar.carrier.N_grid_size_mu = 133;
        end
        SysPar.SimCtrl.relNum = relNum;

        if genTV
            SysPar.SimCtrl.genTV.slotIdx = 0;
            SysPar.SimCtrl.N_slot_run    = 1;
            SysPar.SimCtrl.genTV.enable  = 1;
            SysPar.SimCtrl.genTV.TVname  = sprintf('TVnr_%04d', caseNum);
            if ismember(caseNum, disabled_TC)
                SysPar.SimCtrl.genTV.TVname = sprintf('disabled_TVnr_%04d', caseNum);
            end            
            nTvGen = nTvGen + 1;
        end
        
        % configure channel:
        SysPar.Chan{1}.SNR = -noiseEnergy_dB;

        % Configure SRS ChEst buffs:
        switch(chEstBufIdx)
            case {0}
                SRS_CHEST_BUFF_CFG = SRS_CHEST_BUFF_CFG0;
                SysPar.SimCtrl.enable_dynamic_BF = 1;
                SysPar.carrier.numTxPort = 8;
                SysPar.carrier.N_FhPort_DL = 8;
                SysPar.carrier.N_FhPort_UL = 4;
                SysPar.carrier.Nant_gNB = 8;
            case {1}
                SRS_CHEST_BUFF_CFG = SRS_CHEST_BUFF_CFG0_30MHZ;
                SysPar.SimCtrl.enable_dynamic_BF = 1;
                SysPar.carrier.numTxPort = 8;
                SysPar.carrier.N_FhPort_DL = 8;
                SysPar.carrier.N_FhPort_UL = 4;
                SysPar.carrier.Nant_gNB = 8;
            case {2}
                SRS_CHEST_BUFF_CFG = SRS_CHEST_BUFF_CFG0_50MHZ;
                SysPar.SimCtrl.enable_dynamic_BF = 1;
                SysPar.carrier.numTxPort = 8;
                SysPar.carrier.N_FhPort_DL = 8;
                SysPar.carrier.N_FhPort_UL = 4;
                SysPar.carrier.Nant_gNB = 8;
            case {20}
                SRS_CHEST_BUFF_CFG = SRS_CHEST_BUFF_CFG20;
                SysPar.SimCtrl.enable_dynamic_BF = 1;
                SysPar.carrier.numTxPort = 16;
                SysPar.carrier.N_FhPort_DL = 16;
                SysPar.carrier.N_FhPort_UL = 16;
                SysPar.carrier.Nant_gNB = 64;
            case {22}
                SRS_CHEST_BUFF_CFG = SRS_CHEST_BUFF_CFG22;
                SysPar.SimCtrl.enable_dynamic_BF = 1;
                SysPar.carrier.numTxPort = 16;
                SysPar.carrier.N_FhPort_DL = 16;
                SysPar.carrier.N_FhPort_UL = 16;
                SysPar.carrier.Nant_gNB = 64;
            case {23}
                SRS_CHEST_BUFF_CFG = SRS_CHEST_BUFF_CFG23;
                SysPar.SimCtrl.enable_dynamic_BF = 1;
                SysPar.carrier.numTxPort = 16;
                SysPar.carrier.N_FhPort_DL = 16;
                SysPar.carrier.N_FhPort_UL = 16;
                SysPar.carrier.Nant_gNB = 64;
            case {24}
                SRS_CHEST_BUFF_CFG = SRS_CHEST_BUFF_CFG24;
                SysPar.SimCtrl.enable_dynamic_BF = 1;
                SysPar.carrier.numTxPort = 16;
                SysPar.carrier.N_FhPort_DL = 16;
                SysPar.carrier.N_FhPort_UL = 16;
                SysPar.carrier.Nant_gNB = 64;
            case {25}
                SRS_CHEST_BUFF_CFG = SRS_CHEST_BUFF_CFG25;
                SysPar.SimCtrl.enable_dynamic_BF = 1;
                SysPar.carrier.numTxPort = 16;
                SysPar.carrier.N_FhPort_DL = 16;
                SysPar.carrier.N_FhPort_UL = 16;
                SysPar.carrier.Nant_gNB = 64;
            case {26}
                SRS_CHEST_BUFF_CFG = SRS_CHEST_BUFF_CFG26;
                SysPar.SimCtrl.enable_dynamic_BF = 1;
                SysPar.carrier.numTxPort = 16;
                SysPar.carrier.N_FhPort_DL = 16;
                SysPar.carrier.N_FhPort_UL = 16;
                SysPar.carrier.Nant_gNB = 64;
            case {27}
                SRS_CHEST_BUFF_CFG = SRS_CHEST_BUFF_CFG27;
                SysPar.SimCtrl.enable_dynamic_BF = 1;
                SysPar.carrier.numTxPort = 32;
                SysPar.carrier.N_FhPort_DL = 32;
                SysPar.carrier.N_FhPort_UL = 16;
                SysPar.carrier.Nant_gNB = 64;
            case {28}
                SRS_CHEST_BUFF_CFG = SRS_CHEST_BUFF_CFG28;
                SysPar.SimCtrl.enable_dynamic_BF = 1;
                SysPar.carrier.numTxPort = 16;
                SysPar.carrier.N_FhPort_DL = 16;
                SysPar.carrier.N_FhPort_UL = 16;
                SysPar.carrier.Nant_gNB = 64;
            case {29}
                SRS_CHEST_BUFF_CFG = SRS_CHEST_BUFF_CFG29;
                SysPar.SimCtrl.enable_dynamic_BF = 1;
                SysPar.carrier.numTxPort = 16;
                SysPar.carrier.N_FhPort_DL = 16;
                SysPar.carrier.N_FhPort_UL = 16;
                SysPar.carrier.Nant_gNB = 64;
            otherwise
                error('chEstBufIdx is not supported ...\n');
        end
        SysPar.SimCtrl.bf.N_SRS_CHEST_BUFF = size(SRS_CHEST_BUFF_CFG,1);
        SysPar.SimCtrl.N_UE                = size(SRS_CHEST_BUFF_CFG,1);
        for ueIdx = 0 : (SysPar.SimCtrl.bf.N_SRS_CHEST_BUFF - 1) 
            SysPar.srsChEstBuff{ueIdx + 1}.ueIdx       = SRS_CHEST_BUFF_CFG{ueIdx + 1, 1};
            SysPar.srsChEstBuff{ueIdx + 1}.startPrbGrp = SRS_CHEST_BUFF_CFG{ueIdx + 1, 2};
            SysPar.srsChEstBuff{ueIdx + 1}.nPrbGrp     = SRS_CHEST_BUFF_CFG{ueIdx + 1, 3};
            SysPar.srsChEstBuff{ueIdx + 1}.nUeAnt      = SRS_CHEST_BUFF_CFG{ueIdx + 1, 4};
            SysPar.srsChEstBuff{ueIdx + 1}.nGnbAnt     = SRS_CHEST_BUFF_CFG{ueIdx + 1, 5};
            SysPar.srsChEstBuff{ueIdx + 1}.gainDB      = SRS_CHEST_BUFF_CFG{ueIdx + 1, 6};
            SysPar.srsChEstBuff{ueIdx + 1}.prbGrpSize  = srsPrbGrpSize;
            SysPar.srsChEstBuff{ueIdx + 1}.startValidPrg  = 0;
            SysPar.srsChEstBuff{ueIdx + 1}.nValidPrg  = ceil(273/srsPrbGrpSize);
            if caseNum == 9810
                SysPar.srsChEstBuff{ueIdx + 1}.startValidPrg  = 30;
                SysPar.srsChEstBuff{ueIdx + 1}.nValidPrg      = 60;
                if ueIdx == 3 
                    SysPar.srsChEstBuff{ueIdx + 1}.startValidPrg  = 0;
                    SysPar.srsChEstBuff{ueIdx + 1}.nValidPrg      = 10;
                end
                if ueIdx == 5 
                    SysPar.srsChEstBuff{ueIdx + 1}.startValidPrg  = 100;
                    SysPar.srsChEstBuff{ueIdx + 1}.nValidPrg      = 20;
                end
            elseif (ismember(caseNum, [9369:9372]))
                SysPar.srsChEstBuff{ueIdx + 1}.startValidPrg  = 0;
                SysPar.srsChEstBuff{ueIdx + 1}.nValidPrg      = 52;
            elseif (ismember(caseNum, [9437:9442]))
                SysPar.srsChEstBuff{ueIdx + 1}.startValidPrg  = 0;
                SysPar.srsChEstBuff{ueIdx + 1}.nValidPrg      = 69;
            end
        end
        
        % Configure ue grp paramaters:
        SysPar.SimCtrl.bf.N_UE_GRP = nUeGrps;
        for i = 0 : (nUeGrps - 1)
            ueGrpCfgIdx = find(cellfun(@(x) isequal(x,ueGrpIdxs(i + 1)), UE_GRPS_CFG(:,1)));
            SysPar.bfw{i + 1}.startPrb     = UE_GRPS_CFG{ueGrpCfgIdx, 2};
            SysPar.bfw{i + 1}.nPrb         = UE_GRPS_CFG{ueGrpCfgIdx, 3};
            SysPar.bfw{i + 1}.nRxAnt       = UE_GRPS_CFG{ueGrpCfgIdx, 4};
            SysPar.bfw{i + 1}.nRxAntSrs    = UE_GRPS_CFG{ueGrpCfgIdx, 4};
            SysPar.bfw{i + 1}.nBfLayers    = UE_GRPS_CFG{ueGrpCfgIdx, 5};
            SysPar.bfw{i + 1}.ueIdxs       = UE_GRPS_CFG{ueGrpCfgIdx, 6};
            SysPar.bfw{i + 1}.ueLayersIdxs = UE_GRPS_CFG{ueGrpCfgIdx, 7};
            SysPar.bfw{i + 1}.lambda       = lambda;
            SysPar.bfw{i + 1}.coefBufIdx   = i;
            SysPar.bfw{i + 1}.bfwUL        = mod(caseNum,2); 
            if ismember(caseNum, [9800, 9801])
                SysPar.bfw{i + 1}.bfwUL = 0;
            elseif ismember(caseNum, [9802:9804])
                SysPar.bfw{i + 1}.bfwUL = 1;
            end

            SysPar.bfw{i + 1}.prbGrpSize  = bfwPrbGrpSize;
            SysPar.bfw{i + 1}.startPrbGrp = floor(SysPar.bfw{i + 1}.startPrb /  bfwPrbGrpSize);
            SysPar.bfw{i + 1}.nPrbGrp     = ceil(SysPar.bfw{i + 1}.nPrb / bfwPrbGrpSize);

            % Find the matching row for this caseNum
            for row = 1:size(SRS_BFW_TV_LOOKUP, 1)
                srs_tv = SRS_BFW_TV_LOOKUP{row, 1};
                main_tv = SRS_BFW_TV_LOOKUP{row, 2};
                loadonly_tvs = SRS_BFW_TV_LOOKUP{row, 3};
                prg_size = SRS_BFW_TV_LOOKUP{row, 4};
                n_id_cell = SRS_BFW_TV_LOOKUP{row, 5};
                
                % Check if caseNum matches main TV or any loadOnly TV
                is_main = ~isempty(main_tv) && caseNum == main_tv;
                is_loadonly = any(cellfun(@(x) x == caseNum, loadonly_tvs));
                
                if is_main || is_loadonly
                    % Set SRS TV (handle both single values and cell arrays)
                    if iscell(srs_tv)
                        SysPar.bfw{i + 1}.srsTv = [srs_tv{:}];  % Convert cell array to vector
                    else
                        SysPar.bfw{i + 1}.srsTv = srs_tv;      % Single value
                    end
                    
                    % Set BFW TV based on case type
                    if is_main
                        % Main case: include all related TVs
                        if ~isempty(loadonly_tvs)
                            SysPar.bfw{i + 1}.bfwTv = [caseNum, loadonly_tvs{:}];
                        else
                            SysPar.bfw{i + 1}.bfwTv = caseNum;
                        end
                    else
                        % LoadOnly case
                        SysPar.bfw{i + 1}.bfwTv = caseNum;
                        SysPar.bfw{i + 1}.loadOnly = 1;
                    end
                    
                    % Set optional parameters
                    if ~isempty(prg_size)
                        SysPar.bfw{i + 1}.prgSize = prg_size;
                    end
                    if ~isempty(n_id_cell)
                        SysPar.carrier.N_ID_CELL = n_id_cell;
                    end
                    
                    % found TV, break the loop
                    break;
                end
            end
        end
        SysPar.carrier.Nant_gNB_srs = UE_GRPS_CFG{ueGrpCfgIdx, 4}; % Nant_gNB_srs should be the same for all UEs
        
        % overwrite default BFPforCuphy from the default value 14 to 9 for all MIMO BFW TVs
        if (ismember(chEstBufIdx, [20 22 23 24]))
            SysPar.SimCtrl.BFPforCuphy = 9;
        end
        
%         if SysPar.SimCtrl.genTV.enable && SysPar.SimCtrl.genTV.launchPattern
%             if ~ismember(caseNum, disabled_TC)
%                 LPFileName = 'launch_pattern_nrSim';
%             else
%                 LPFileName = 'disabled_launch_pattern_nrSim';
%             end
%             slotIdx =  SysPar.SimCtrl.genTV.slotIdx;
%             genSingleSlotLPFile(LPFileName, caseNum, slotIdx);
%         end

        % run NR simulator:
        [SysPar, UE, gNB] = nrSimulator(SysPar);  
        
        % complience check:
        testPass = 1;
        if testCompliance
            nCompChecks = nCompChecks + 1;
            bfw_results = SysPar.SimCtrl.results.bfw;
            for ueGrpIdx = 0 : (nUeGrps - 1)
                minBfSinr = bfw_results{ueGrpIdx + 1}.minBfSinr;
                if(minBfSinr < 26) && (caseNum~=9810)
                    nCompErrs = nCompErrs + 1;
                    testPass = 0;
                end 
            end
        end
        fprintf('%4d  %2d\n', CFG{idxSet, 1}, testPass);
    end
end

fprintf('-----------\n');
fprintf('Total Compliance TC = %d, PASS = %d, FAIL = %d, Total TV generated = %d\n\n', nCompChecks, nCompChecks-nCompErrs, nCompErrs, nTvGen);
toc; 
fprintf('\n');
end
