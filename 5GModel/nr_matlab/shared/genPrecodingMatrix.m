% SPDX-FileCopyrightText: Copyright (c) 2025 NVIDIA CORPORATION & AFFILIATES. All rights reserved.
% SPDX-License-Identifier: Apache-2.0
%
% Licensed under the Apache License, Version 2.0 (the "License");
% you may not use this file except in compliance with the License.
% You may obtain a copy of the License at
%
% http://www.apache.org/licenses/LICENSE-2.0
%
% Unless required by applicable law or agreed to in writing, software
% distributed under the License is distributed on an "AS IS" BASIS,
% WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
% See the License for the specific language governing permissions and
% limitations under the License.

a = 1/sqrt(2);
b = 1/2;
c = 1/(2*sqrt(2));
d = 1/(2*sqrt(3));
e = 1/4;

% example precoding matrix from TS38.211 6.3.1.5

PM_W12 = {a*[1;0], a*[0;1], a*[1;1], a*[1;-1], a*[1;j], a*[1;-j]};

PM_W14 = {b*[1 0 0 0]', b*[0 1 0 0]', b*[0 0 1 0]', b*[0 0 0 1]', ...
        b*[1 0 1 0]', b*[1 0 -1 0]', b*[1 0 j 0]', b*[1 0 -j 0]', ...
        b*[0 1 0 1]', b*[0 1 0 -1]', b*[0 1 0 j]', b*[0 1 0 -j]', ...
        b*[1 1 1 1]', b*[1 1 j j]', b*[1 1 -1 -1]', b*[1 1 -j -j]', ...
        b*[1 j 1 j]', b*[1 j j -1]', b*[1 j -1 -j]', b*[1 j -j 1]', ...
        b*[1 -1 1 -1]', b*[1 -1 j -j]', b*[1 -1 -1 1]', b*[1 -1 -j j]', ...
        b*[1 -j 1 -j]', b*[1 -j j 1]', b*[1 -j -1 j]', b*[1 -j -j -1]'};

PM_W22 = {a*[1 0; 0 1], b*[1 1; 1 -1], b*[1 1; j -j]};

PM_W24 = {b*[1 0; 0 1; 0 0; 0 0], b*[1 0; 0 0; 0 1; 0 0], ...
       b*[1 0; 0 0; 0 0; 0 1], b*[0 0; 1 0; 0 1; 0 0], ...
       b*[0 0; 1 0; 0 0; 0 1], b*[0 0; 0 0; 1 0; 0 1], ...
       b*[1 0; 0 1; 1 0; 0 -j], b*[1 0; 0 1; 1 0; 0 j], ...
       b*[1 0; 0 1; -j 0; 0 1], b*[1 0; 0 1; -j 0; 0 -1], ...
       b*[1 0; 0 1; -1 0; 0 -j], b*[1 0; 0 1; -1 0; 0 j], ...
       b*[1 0; 0 1; j 0; 0 1], b*[1 0; 0 1; j 0; 0 -1], ...
       c*[1 1; 1 1; 1 -1; 1 -1], c*[1 1; 1 1; j -j; j -j], ...
       c*[1 1; j j; 1 -1; j -j], c*[1 1; j j; j -j; -1 1], ...
       c*[1 1; -1 -1; 1 -1; -1 1], c*[1 1; -1 -1; j -j; -j j], ...
       c*[1 1; -j -j; 1 -1; -j j], c*[1 1; -j -j; j -j; 1 -1]};
   
PM_W34 = {b*[1 0 0; 0 1 0; 0 0 1; 0 0 0], b*[1 0 0; 0 1 0; 1 0 0; 0 0 1], ...
       b*[1 0 0; 0 1 0; -1 0 0; 0 0 1], d*[1 1 1; 1 -1 1; 1 1 -1; 1 -1 -1], ...
       d*[1 1 1; 1 -1 1; j j -j; j -j -j], d*[1 1 1; -1 1 -1; 1 1 -1; -1 1 1], ... 
       d*[1 1 1; -1 1 -1; j j -j; -j j j]};
   
PM_W44 = {b*[1 0 0 0; 0 1 0 0; 0 0 1 0; 0 0 0 1], ...
       c*[1 1 0 0; 0 0 1 1; 1 -1 0 0; 0 0 1 -1], ...
       c*[1 1 0 0; 0 0 1 1; j -j 0 0; 0 0 j -j], ...
       e*[1 1 1 1; 1 -1 1 -1; 1 1 -1 -1; 1 -1 -1 1], ...
       e*[1 1 1 1; 1 -1 1 -1; j j -j -j; j -j -j j]};
   
% save PM_W PM_W12 PM_W14 PM_W22 PM_W24 PM_W34 PM_W44

% only take the last two matrices for each nLayers/nPorts combination   

PM_W = {a*[1;j], a*[1;-j], ...
        b*[1 -j -1 j]', b*[1 -j -j -1]', ...
        b*[1 1; 1 -1], b*[1 1; j -j], ...
        c*[1 1; -j -j; 1 -1; -j j], c*[1 1; -j -j; j -j; 1 -1], ...   
        d*[1 1 1; -1 1 -1; 1 1 -1; -1 1 1], ... 
        d*[1 1 1; -1 1 -1; j j -j; -j j j], ...
        e*[1 1 1 1; 1 -1 1 -1; 1 1 -1 -1; 1 -1 -1 1], ...
        e*[1 1 1 1; 1 -1 1 -1; j j -j -j; j -j -j j]};
   
PM_W{13} = complex([1; 1]);
PM_W{14} = complex(diag(ones(1, 4)));
PM_W{15} = complex([1; 0; 1; 0]);

save PM_W PM_W